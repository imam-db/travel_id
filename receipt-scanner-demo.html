<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt Scanner Demo - TrevID</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/receipt-scanner.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <img 
                    class="brand-logo" 
                    src="assets/brand/trevid_logo.png" 
                    srcset="/assets/brand/trevid_logo.png 1x, /assets/brand/trevid_logo@2x.png 2x" 
                    alt="TrevID â€“ Business Companion" 
                    width="140" height="36" />
            </div>
            <div class="user-info">
                <span>Hello, John Doe</span>
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="travel.html" class="nav-item">
            <i class="fas fa-plane"></i>
            <span>Travel</span>
        </a>
        <a href="expenses.html" class="nav-item active" aria-current="page">
            <i class="fas fa-receipt"></i>
            <span>Expenses</span>
        </a>
        <a href="cash-advance.html" class="nav-item">
            <i class="fas fa-money-bill"></i>
            <span>Cash Advance</span>
        </a>
        <a href="approvals.html" class="nav-item">
            <i class="fas fa-check-circle"></i>
            <span>Approvals</span>
        </a>
    </nav>

    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <div class="header-content">
                    <h1><i class="fas fa-camera"></i> Receipt Scanner Demo</h1>
                    <p class="page-description">Test the OCR functionality with your receipt images</p>
                </div>
            </div>

            <!-- Receipt Scanner Component -->
            <div id="receipt-scanner-container"></div>

            <!-- Demo Results -->
            <div class="demo-results" id="demo-results" style="display: none;">
                <div class="results-header">
                    <h2><i class="fas fa-check-circle"></i> Extraction Complete!</h2>
                    <p>Here's what we extracted from your receipt:</p>
                </div>
                
                <div class="results-content">
                    <div class="result-card">
                        <h3>Expense Details</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <label>Merchant</label>
                                <span id="result-merchant">-</span>
                            </div>
                            <div class="result-item">
                                <label>Date</label>
                                <span id="result-date">-</span>
                            </div>
                            <div class="result-item">
                                <label>Time</label>
                                <span id="result-time">-</span>
                            </div>
                            <div class="result-item">
                                <label>Amount</label>
                                <span id="result-amount">-</span>
                            </div>
                            <div class="result-item">
                                <label>Currency</label>
                                <span id="result-currency">-</span>
                            </div>
                            <div class="result-item">
                                <label>Tax</label>
                                <span id="result-tax">-</span>
                            </div>
                            <div class="result-item">
                                <label>Category</label>
                                <span id="result-category">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-actions">
                        <button class="btn secondary" id="try-another">
                            <i class="fas fa-redo"></i> Try Another Receipt
                        </button>
                        <button class="btn primary" id="create-expense">
                            <i class="fas fa-plus"></i> Create Expense Entry
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tips Section -->
            <div class="tips-section">
                <h3><i class="fas fa-lightbulb"></i> Tips for Better OCR Results</h3>
                <div class="tips-grid">
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-sun"></i>
                        </div>
                        <div class="tip-content">
                            <h4>Good Lighting</h4>
                            <p>Ensure your receipt is well-lit and avoid shadows or glare</p>
                        </div>
                    </div>
                    
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-crop"></i>
                        </div>
                        <div class="tip-content">
                            <h4>Proper Framing</h4>
                            <p>Keep the entire receipt within the frame, avoid cutting off edges</p>
                        </div>
                    </div>
                    
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="tip-content">
                            <h4>Clear Focus</h4>
                            <p>Make sure the text is sharp and readable before capturing</p>
                        </div>
                    </div>
                    
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-straighten"></i>
                        </div>
                        <div class="tip-content">
                            <h4>Straight Angle</h4>
                            <p>Hold your device parallel to the receipt for best results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="js/ocr-processor.js"></script>
    <script src="js/receipt-scanner.js"></script>
    <script>
        // Initialize Receipt Scanner
        document.addEventListener('DOMContentLoaded', function() {
            // Show loading indicator while initializing
            showToast('Initializing receipt scanner...', 'info');
            
            const scanner = new ReceiptScanner('receipt-scanner-container', {
                maxFileSize: 10 * 1024 * 1024, // 10MB
                quality: 0.8,
                maxWidth: 1920,
                maxHeight: 1920
            });

            // Hide loading after a short delay
            setTimeout(() => {
                const toasts = document.querySelectorAll('.toast');
                toasts.forEach(toast => {
                    if (toast.textContent.includes('Initializing')) {
                        toast.classList.remove('show');
                        setTimeout(() => toast.remove(), 300);
                    }
                });
            }, 2000);

            // Listen for receipt processing completion
            document.getElementById('receipt-scanner-container').addEventListener('receiptProcessed', function(event) {
                const data = event.detail;
                showResults(data);
            });

            function showResults(data) {
                // Hide scanner, show results
                document.getElementById('receipt-scanner-container').style.display = 'none';
                document.getElementById('demo-results').style.display = 'block';

                // Populate results
                document.getElementById('result-merchant').textContent = data.merchant || '-';
                document.getElementById('result-date').textContent = data.date || '-';
                document.getElementById('result-time').textContent = data.time || '-';
                document.getElementById('result-amount').textContent = data.amount ? formatCurrency(data.amount, data.currency) : '-';
                document.getElementById('result-currency').textContent = data.currency || '-';
                document.getElementById('result-tax').textContent = data.tax ? formatCurrency(data.tax, data.currency) : '-';
                document.getElementById('result-category').textContent = data.category || '-';

                // Scroll to results
                document.getElementById('demo-results').scrollIntoView({ behavior: 'smooth' });
            }

            function formatCurrency(amount, currency = 'IDR') {
                const formatter = new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: currency,
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 2
                });
                return formatter.format(amount);
            }

            // Result actions
            document.getElementById('try-another').addEventListener('click', function() {
                document.getElementById('receipt-scanner-container').style.display = 'block';
                document.getElementById('demo-results').style.display = 'none';
                
                // Reset scanner
                scanner.closePreview();
            });

            document.getElementById('create-expense').addEventListener('click', function() {
                // In real app, this would navigate to expense creation form with pre-filled data
                alert('In the real app, this would create a new expense entry with the extracted data!');
            });

            // Show toast notification
            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                
                // Show toast
                setTimeout(() => toast.classList.add('show'), 100);
                
                // Hide toast
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            // Add toast styles
            const toastStyles = `
                <style>
                .toast {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--card);
                    border: 1px solid var(--card-border);
                    border-radius: 8px;
                    padding: 12px 16px;
                    box-shadow: var(--shadow-md);
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    z-index: 1000;
                    transform: translateX(100%);
                    transition: transform 0.3s ease;
                }
                
                .toast.show {
                    transform: translateX(0);
                }
                
                .toast-success {
                    border-left: 4px solid var(--success);
                    color: var(--success);
                }
                
                .toast-error {
                    border-left: 4px solid var(--danger);
                    color: var(--danger);
                }
                
                .toast-info {
                    border-left: 4px solid var(--primary-color);
                    color: var(--primary-color);
                }
                </style>
            `;
            document.head.insertAdjacentHTML('beforeend', toastStyles);
        });
    </script>

    <style>
        /* Demo-specific styles */
        .demo-results {
            margin-top: 32px;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .results-header {
            background: linear-gradient(135deg, var(--success), #16A34A);
            color: white;
            padding: 24px;
            text-align: center;
        }

        .results-header h2 {
            margin: 0 0 8px 0;
            font-size: 1.5rem;
        }

        .results-header p {
            margin: 0;
            opacity: 0.9;
        }

        .results-content {
            padding: 24px;
        }

        .result-card {
            background: var(--bg-50);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 24px;
        }

        .result-card h3 {
            margin: 0 0 16px 0;
            color: var(--ink-900);
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .result-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .result-item label {
            font-size: 0.85rem;
            color: var(--ink-500);
            font-weight: 500;
        }

        .result-item span {
            font-size: 1rem;
            color: var(--ink-900);
            font-weight: 500;
        }

        .result-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        @media (max-width: 640px) {
            .result-actions {
                flex-direction: column;
            }
        }

        /* Tips Section */
        .tips-section {
            margin-top: 40px;
            padding: 32px 0;
        }

        .tips-section h3 {
            text-align: center;
            margin-bottom: 32px;
            color: var(--ink-900);
            font-size: 1.3rem;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .tip-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: 16px;
            align-items: flex-start;
        }

        .tip-icon {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .tip-content h4 {
            margin: 0 0 8px 0;
            color: var(--ink-900);
            font-size: 1rem;
        }

        .tip-content p {
            margin: 0;
            color: var(--ink-700);
            font-size: 0.9rem;
            line-height: 1.5;
        }
    </style>
</body>
</html>