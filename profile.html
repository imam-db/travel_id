<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Travel Expense Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="icon-192.svg">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-plane"></i>
                <span>TravelExpense</span>
            </div>
            <div class="user-info">
                <span>Hello, John Doe</span>
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="travel.html" class="nav-item">
            <i class="fas fa-plane"></i>
            <span>Travel</span>
        </a>
        <a href="vehicle.html" class="nav-item">
            <i class="fas fa-car"></i>
            <span>Vehicle</span>
        </a>
        <a href="expenses.html" class="nav-item">
            <i class="fas fa-receipt"></i>
            <span>Expenses</span>
        </a>
        <a href="approvals.html" class="nav-item">
            <i class="fas fa-check-circle"></i>
            <span>Approvals</span>
        </a>
        <a href="profile.html" class="nav-item active">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Sticky Sub Navigation -->
            <nav class="subnav">
                <a href="#personal" class="active">Personal</a>
                <a href="#business">Business</a>
                <a href="#reimb">Reimb</a>
                <a href="#budget">Budget</a>
                <a href="#integrations">Integrations</a>
                <a href="#mwp">MWP</a>
                <a href="#notifications">Notifications</a>
                <a href="#delegation">Delegation</a>
                <a href="#sessions">Sessions</a>
                <a href="#security">Security</a>
            </nav>
            <!-- Profile Header -->
            <section class="profile-header">
                <div class="profile-avatar">
                    <img src="https://via.placeholder.com/120x120" alt="Profile Picture" id="profileImage">
                    <button class="change-photo-btn" onclick="changePhoto()">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                <div class="profile-info">
                    <h1>John Doe</h1>
                    <p class="job-title">Senior Marketing Manager</p>
                    <p class="department">Marketing Department</p>
                    <p class="employee-id">ID: EMP-2024-001</p>
                </div>
            </section>

            <!-- Profile Stats -->
            <section class="profile-stats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-plane"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">24</span>
                            <span class="stat-label">Total Trips</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">48</span>
                            <span class="stat-label">Expense Reports</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">$125K</span>
                            <span class="stat-label">Total Expenses</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">96%</span>
                            <span class="stat-label">Approval Rate</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Sections -->
            <section class="profile-sections">
                <!-- Personal Information -->
                <div id="personal" class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-user"></i> Personal Information</h3>
                        <button class="edit-btn" onclick="editPersonalInfo()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Full Name</label>
                                <span>John Doe</span>
                            </div>
                            <div class="info-item">
                                <label>Email</label>
                                <span>john.doe@company.com</span>
                            </div>
                            <div class="info-item">
                                <label>Phone</label>
                                <span>+62 812-3456-7890</span>
                            </div>
                            <div class="info-item">
                                <label>Employee ID</label>
                                <span>EMP-2024-001</span>
                            </div>
                            <div class="info-item">
                                <label>Department</label>
                                <span>Marketing Department</span>
                            </div>
                            <div class="info-item">
                                <label>Position</label>
                                <span>Senior Marketing Manager</span>
                            </div>
                            <div class="info-item">
                                <label>Join Date</label>
                                <span>15 January 2020</span>
                            </div>
                            <div class="info-item">
                                <label>Manager</label>
                                <span>Sarah Johnson</span>
                            </div>
                        </div>
                        <div class="last-updated">Last updated by You on 22 Dec 2024, 14:30</div>
                    </div>
                </div>

                <!-- Travel Preferences -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-plane"></i> Travel Preferences</h3>
                        <button class="edit-btn" onclick="editTravelPrefs()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="preferences-section">
                            <h4>Booking Preferences</h4>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Preferred Airline</label>
                                    <span>Garuda Indonesia</span>
                                </div>
                                <div class="info-item">
                                    <label>Seat Preference</label>
                                    <span>Aisle Seat</span>
                                </div>
                                <div class="info-item">
                                    <label>Baggage Preference</label>
                                    <span>25kg checked bag</span>
                                </div>
                                <div class="info-item">
                                    <label>Meal Preference</label>
                                    <span>Halal</span>
                                </div>
                                <div class="info-item">
                                    <label>Hotel Category</label>
                                    <span>4-5 Star Hotels</span>
                                </div>
                                <div class="info-item">
                                    <label>Room Type</label>
                                    <span>Single Room, Non-smoking</span>
                                </div>
                                <div class="info-item">
                                    <label>Car Rental</label>
                                    <span>Compact/Economy</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preferences-section">
                            <h4>Loyalty Programs</h4>
                            <div class="loyalty-list">
                                <div class="loyalty-item">
                                    <div class="loyalty-icon airline">
                                        <i class="fas fa-plane"></i>
                                    </div>
                                    <div class="loyalty-details">
                                        <span class="loyalty-name">Garuda Miles</span>
                                        <span class="loyalty-number">GM123456789</span>
                                        <span class="loyalty-tier">Gold Member</span>
                                    </div>
                                </div>
                                
                                <div class="loyalty-item">
                                    <div class="loyalty-icon hotel">
                                        <i class="fas fa-bed"></i>
                                    </div>
                                    <div class="loyalty-details">
                                        <span class="loyalty-name">Marriott Bonvoy</span>
                                        <span class="loyalty-number">MB987654321</span>
                                        <span class="loyalty-tier">Platinum Elite</span>
                                    </div>
                                </div>
                                
                                <div class="loyalty-item">
                                    <div class="loyalty-icon rental">
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="loyalty-details">
                                        <span class="loyalty-name">Hertz Gold Plus</span>
                                        <span class="loyalty-number">HZ456789123</span>
                                        <span class="loyalty-tier">Gold Member</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preferences-section">
                            <h4>Cash Advance Defaults</h4>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Default Currency</label>
                                    <span>IDR (Indonesian Rupiah)</span>
                                </div>
                                <div class="info-item">
                                    <label>Disbursement Method</label>
                                    <span>Bank Transfer</span>
                                </div>
                                <div class="info-item">
                                    <label>Default Amount</label>
                                    <span>IDR 10,000,000</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="last-updated">Last updated by John Doe on 18 Dec 2024</div>
                    </div>
                </div>

                <!-- Business Information -->
                <div id="business" class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-building"></i> Business Information</h3>
                        <span class="badge-admin"><i class="fas fa-lock"></i> Managed by Admin</span>
                    </div>
                    <div class="card-content">
                        <div class="info-grid locked">
                            <div class="info-item locked">
                                <label>Cost Center <i class="fas fa-lock lock-icon"></i></label>
                                <span>CC-MKT-001</span>
                            </div>
                            <div class="info-item locked">
                                <label>Division/Region <i class="fas fa-lock lock-icon"></i></label>
                                <span>Marketing - Jakarta</span>
                            </div>
                            <div class="info-item locked">
                                <label>Employee Grade <i class="fas fa-lock lock-icon"></i></label>
                                <span>Grade 12 - Senior Manager</span>
                            </div>
                            <div class="info-item locked">
                                <label>Advance Limit <i class="fas fa-lock lock-icon"></i></label>
                                <span>$5,000 per request</span>
                            </div>
                        </div>
                        <div class="approver-chain">
                            <h4>Approval Chain</h4>
                            <div class="chain-flow">
                                <div class="chain-step">
                                    <i class="fas fa-user"></i>
                                    <span>Line Manager</span>
                                    <small>Sarah Johnson</small>
                                </div>
                                <i class="fas fa-arrow-right chain-arrow"></i>
                                <div class="chain-step">
                                    <i class="fas fa-calculator"></i>
                                    <span>Finance</span>
                                    <small>Michael Chen</small>
                                </div>
                                <i class="fas fa-arrow-right chain-arrow"></i>
                                <div class="chain-step">
                                    <i class="fas fa-users"></i>
                                    <span>HR</span>
                                    <small>Lisa Wong</small>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Last updated by HR Admin on 15 Dec 2024</div>
                    </div>
                </div>

                <!-- Budget Information -->
                <div id="budget" class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-wallet"></i> Budget Information</h3>
                        <span class="badge-admin"><i class="fas fa-lock"></i> Managed by Admin</span>
                    </div>
                    <div class="card-content">
                        <div class="budget-overview locked">
                            <div class="budget-item">
                                <div class="budget-header">
                                    <span class="budget-title">Monthly Travel Budget</span>
                                    <span class="budget-amount">$15,000</span>
                                </div>
                                <div class="budget-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 68%"></div>
                                    </div>
                                    <span class="progress-text">68% Used ($10,200)</span>
                                </div>
                            </div>
                            
                            <div class="budget-item">
                                <div class="budget-header">
                                    <span class="budget-title">Yearly Travel Budget</span>
                                    <span class="budget-amount">$180,000</span>
                                </div>
                                <div class="budget-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 45%"></div>
                                    </div>
                                    <span class="progress-text">45% Used ($81,000)</span>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Last updated by Finance Admin on 10 Dec 2024</div>
                    </div>
                </div>

                <!-- Bank & Tax Information -->
                <div id="reimb" class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-university"></i> Bank & Tax Information</h3>
                        <button class="edit-btn" onclick="editBankInfo()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Bank Name</label>
                                <span>Bank Central Asia (BCA)</span>
                            </div>
                            <div class="info-item">
                                <label>Account Number</label>
                                <div class="sensitive-data">
                                    <span id="bankAccount" class="masked-data">****-****-1234</span>
                                    <button class="reveal-btn" onclick="revealSensitiveData('bankAccount', '1234-5678-1234')">
                                        <i class="fas fa-eye"></i> Reveal
                                    </button>
                                    <button class="btn-secondary" onclick="editSensitiveField('bankAccount', 'Bank Account')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                </div>
                                <small class="helper-text">Account number will be used for reimbursements</small>
                            </div>
                            <div class="info-item">
                                <label>Account Holder</label>
                                <span>John Doe</span>
                                <small class="helper-text">Must match your legal name on ID</small>
                            </div>
                            <div class="info-item">
                                <label>Currency</label>
                                <span>IDR (Indonesian Rupiah)</span>
                            </div>
                            <div class="info-item">
                                <label>Tax ID (NPWP)</label>
                                <div class="sensitive-data">
                                    <span id="taxId" class="masked-data">**.***.***.*-***.***</span>
                                    <button class="reveal-btn" onclick="revealSensitiveData('taxId', '12.345.678.9-012.000')">
                                        <i class="fas fa-eye"></i> Reveal
                                    </button>
                                    <button class="btn-secondary" onclick="editSensitiveField('taxId', 'Tax ID')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                </div>
                                <small class="helper-text">Required for tax reporting compliance</small>
                            </div>
                            <div class="info-item">
                                <label>Verification Status</label>
                                <span class="status-verified"><i class="fas fa-check-circle"></i> Verified</span>
                            </div>
                        </div>
                        <div class="last-updated">Last updated by John Doe on 20 Nov 2024</div>
                    </div>
                </div>

                <!-- Policy Snapshot -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-contract"></i> Policy Snapshot</h3>
                        <span class="policy-badge">Grade 12 - Jakarta</span>
                    </div>
                    <div class="card-content">
                        <div class="policy-grid">
                            <div class="policy-item">
                                <div class="policy-header">
                                    <i class="fas fa-utensils"></i>
                                    <span>Per-diem Rates <i class="fas fa-info-circle tooltip-icon" title="Daily allowance for meals and incidental expenses during business travel"></i></span>
                                </div>
                                <div class="policy-details">
                                    <div class="policy-row">
                                        <span>Domestic</span>
                                        <span>IDR 500,000/day</span>
                                    </div>
                                    <div class="policy-row">
                                        <span>International</span>
                                        <span>$150/day</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="policy-item">
                                <div class="policy-header">
                                    <i class="fas fa-tags"></i>
                                    <span>Category Caps <i class="fas fa-info-circle tooltip-icon" title="Maximum spending limits for different expense categories"></i></span>
                                </div>
                                <div class="policy-details">
                                    <div class="policy-row">
                                        <span>Accommodation</span>
                                        <span>$300/night</span>
                                    </div>
                                    <div class="policy-row">
                                        <span>Transportation</span>
                                        <span>Business Class</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="policy-item">
                                <div class="policy-header">
                                    <i class="fas fa-car"></i>
                                    <span>Mileage Policy <i class="fas fa-info-circle tooltip-icon" title="Reimbursement rates and rules for vehicle usage during business travel"></i></span>
                                </div>
                                <div class="policy-details">
                                    <div class="policy-row">
                                        <span>Rate</span>
                                        <span>IDR 3,500/km</span>
                                    </div>
                                    <div class="policy-row">
                                        <span>Fuel Efficiency</span>
                                        <span>12 km/liter</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="policy-item">
                                <div class="policy-header">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>Budget Enforcement <i class="fas fa-info-circle tooltip-icon" title="Rules and limits that control spending within budget parameters"></i></span>
                                </div>
                                <div class="policy-details">
                                    <div class="policy-row">
                                        <span>Hard Limit <i class="fas fa-info-circle tooltip-icon" title="Maximum budget that cannot be exceeded without special approval"></i></span>
                                        <span class="hard-limit">$20,000/month</span>
                                    </div>
                                    <div class="policy-row">
                                        <span>Soft Warning <i class="fas fa-info-circle tooltip-icon" title="Budget threshold that triggers warnings but allows continued spending"></i></span>
                                        <span class="soft-limit">$15,000/month</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Policy effective from 1 Jan 2024</div>
                    </div>
                </div>

                <!-- Integrations -->
                <div class="profile-card" id="integrations">
                    <div class="card-header">
                        <h3><i class="fas fa-plug"></i> Integrations</h3>
                        <div class="last-updated">Last updated by IT Admin on 20 Dec 2024</div>
                    </div>
                    <div class="card-content">
                        <div class="integration-list">
                            <div class="integration-item">
                                <div class="integration-info">
                                    <div class="integration-icon traveloka">
                                        <i class="fas fa-plane"></i>
                                    </div>
                                    <div class="integration-details">
                                        <span class="integration-name">Traveloka for Business</span>
                                        <span class="integration-desc">Book flights and hotels</span>
                                    </div>
                                </div>
                                <div class="integration-status">
                                    <span class="status-chip connected">Connected (2d ago)</span>
                                    <div class="integration-actions">
                                        <button class="reconnect-btn" onclick="reconnectIntegration('traveloka')">Reconnect</button>
                                        <button class="view-logs-btn" onclick="viewIntegrationLogs('traveloka')">View Logs</button>
                                    </div>
                                    <div class="integration-meta">
                                        <small>Last sync: Bookings, Receipts • Scope: Full access</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="integration-item">
                                <div class="integration-info">
                                    <div class="integration-icon erp">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="integration-details">
                                        <span class="integration-name">ERP/Payroll System</span>
                                        <span class="integration-desc">Export expense data</span>
                                    </div>
                                </div>
                                <div class="integration-status">
                                    <span class="status-chip connected">Connected (1h ago)</span>
                                    <div class="integration-actions">
                                        <button class="reconnect-btn" onclick="reconnectIntegration('erp')">Reconnect</button>
                                        <button class="view-logs-btn" onclick="viewIntegrationLogs('erp')">View Logs</button>
                                    </div>
                                    <div class="integration-meta">
                                        <small>Last sync: Employee data, Cost centers • Scope: Read-only</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="integration-item">
                                <div class="integration-info">
                                    <div class="integration-icon slack">
                                        <i class="fab fa-slack"></i>
                                    </div>
                                    <div class="integration-details">
                                        <span class="integration-name">Slack Notifications</span>
                                        <span class="integration-desc">Receive updates in Slack</span>
                                    </div>
                                </div>
                                <div class="integration-status">
                                    <span class="status-chip error">Error</span>
                                    <div class="integration-actions">
                                        <button class="reconnect-btn" onclick="reconnectIntegration('slack')">Reconnect</button>
                                        <button class="view-logs-btn" onclick="viewIntegrationLogs('slack')">View Logs</button>
                                    </div>
                                    <div class="integration-meta">
                                        <small>Last attempt: Token expired • Scope: Notifications only</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Last sync: 5 minutes ago</div>
                    </div>
                </div>

                <!-- MWP Tools -->
                <div class="profile-card" id="mwp">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-alt"></i> MWP Tools</h3>
                        <div class="last-updated">Last updated by John Doe on 18 Dec 2024</div>
                    </div>
                    <div class="card-content">
                        <div class="mwp-tools">
                            <div class="tool-section">
                                <h4>Templates</h4>
                                <div class="tool-buttons">
                                    <button class="tool-btn" onclick="downloadMWPTemplate()">
                                        <i class="fas fa-download"></i>
                                        <span>Download Template</span>
                                    </button>
                                    <button class="tool-btn" onclick="uploadMWPTemplate()">
                                        <i class="fas fa-upload"></i>
                                        <span>Upload Template</span>
                                    </button>
                                    <button class="tool-btn secondary" onclick="openValidationResults()">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Open Validation Results</span>
                                    </button>
                                </div>
                                <div class="upload-preferences">
                                    <label class="preference-item">
                                        <input type="radio" name="upload-mode" value="merge" checked>
                                        <span>Merge with existing data</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="radio" name="upload-mode" value="overwrite">
                                        <span>Overwrite existing data</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="tool-section">
                                <h4>Current Month Status</h4>
                                <div class="mwp-status">
                                    <div class="status-item">
                                        <span class="status-label">December 2024</span>
                                        <span class="status-value submitted">Submitted</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">Approval Status</span>
                                        <span class="status-value approved">Approved by Manager</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">Total Days</span>
                                        <span class="status-value">18 working days</span>
                                    </div>
                                </div>
                                <button class="view-mwp-btn" onclick="viewCurrentMWP()">
                                    <i class="fas fa-eye"></i>
                                    View Current MWP
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Defaults -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-car"></i> Vehicle Defaults</h3>
                        <button class="edit-btn" onclick="editVehicleDefaults()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>License Plate</label>
                                <span>B 1234 XYZ</span>
                            </div>
                            <div class="info-item">
                                <label>Vehicle Type</label>
                                <span>Toyota Avanza</span>
                            </div>
                            <div class="info-item">
                                <label>Fuel Type</label>
                                <span>Pertalite</span>
                            </div>
                            <div class="info-item">
                                <label>Reimbursement Rate</label>
                                <span>IDR 3,500/km</span>
                            </div>
                            <div class="info-item">
                                <label>Fuel Efficiency</label>
                                <span>12 km/liter</span>
                            </div>
                        </div>
                        <div class="last-updated">Last updated by John Doe on 5 Dec 2024</div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="profile-card" id="notifications">
                    <div class="card-header">
                        <h3><i class="fas fa-bell"></i> Notification Settings</h3>
                    </div>
                    <div class="card-content">
                        <div class="notification-matrix">
                            <div class="matrix-header">
                                <div class="matrix-label">Notification Type</div>
                                <div class="matrix-channels">
                                    <div class="channel-header-group">
                                        <span class="channel-header">Email</span>
                                        <button class="test-notification-btn" onclick="testNotification('email')" title="Test Email"><i class="fas fa-paper-plane"></i></button>
                                    </div>
                                    <div class="channel-header-group">
                                        <span class="channel-header">Push</span>
                                        <button class="test-notification-btn" onclick="testNotification('push')" title="Test Push"><i class="fas fa-mobile-alt"></i></button>
                                    </div>
                                    <div class="channel-header-group">
                                        <span class="channel-header">Slack</span>
                                        <button class="test-notification-btn" onclick="testNotification('slack')" title="Test Slack"><i class="fab fa-slack"></i></button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">MWP Comments</span>
                                    <span class="notification-desc">New comments on MWP submissions</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">Expense Rejected</span>
                                    <span class="notification-desc">When expense reports are rejected</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">Payment Done</span>
                                    <span class="notification-desc">When payments are processed</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox">
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">Over Budget Warning</span>
                                    <span class="notification-desc">When approaching budget limits</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">Approval Required</span>
                                    <span class="notification-desc">When approvals are needed</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification-schedule">
                            <h4>Notification Schedule</h4>
                            <div class="schedule-settings">
                                <div class="schedule-item">
                                    <div class="schedule-info">
                                        <span class="schedule-title">Quiet Hours</span>
                                        <span class="schedule-desc">No push notifications during these hours</span>
                                    </div>
                                    <div class="time-range">
                                        <select class="time-select">
                                            <option value="22">22:00</option>
                                            <option value="23">23:00</option>
                                            <option value="00" selected>00:00</option>
                                        </select>
                                        <span>to</span>
                                        <select class="time-select">
                                            <option value="06">06:00</option>
                                            <option value="07" selected>07:00</option>
                                            <option value="08">08:00</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="schedule-item">
                                    <div class="schedule-info">
                                        <span class="schedule-title">Digest Frequency</span>
                                        <span class="schedule-desc">Receive summary of notifications</span>
                                    </div>
                                    <select class="digest-select">
                                        <option value="none">No Digest</option>
                                        <option value="daily" selected>Daily Digest</option>
                                        <option value="weekly">Weekly Digest</option>
                                    </select>
                                </div>
                                
                                <div class="schedule-item">
                                    <div class="schedule-info">
                                        <span class="schedule-title">Digest Time</span>
                                        <span class="schedule-desc">When to send digest</span>
                                    </div>
                                    <select class="time-select">
                                        <option value="08" selected>08:00</option>
                                        <option value="09">09:00</option>
                                        <option value="18">18:00</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="last-updated">Last updated by John Doe on 22 Dec 2024</div>
                    </div>
                </div>

                <!-- Permissions & Audit Trail -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shield-alt"></i> Permissions & Audit Trail</h3>
                    </div>
                    <div class="card-content">
                        <div class="permissions-section">
                            <h4>Edit Permissions</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Personal Information</span>
                                        <span class="permission-desc">Name, email, phone, address</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge editable">You can edit</span>
                                    </div>
                                </div>
                                
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Budget Information</span>
                                        <span class="permission-desc">Budget limits, cost centers</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge managed">Managed by Admin</span>
                                    </div>
                                </div>
                                
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Approver Chain</span>
                                        <span class="permission-desc">Line manager, finance approver</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge managed">Managed by HR</span>
                                    </div>
                                </div>
                                
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Travel Preferences</span>
                                        <span class="permission-desc">Airline, hotel, car preferences</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge editable">You can edit</span>
                                    </div>
                                </div>
                                
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Bank & Tax Information</span>
                                        <span class="permission-desc">Bank account, tax ID</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge restricted">Restricted - Contact Finance</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="audit-section">
                            <h4>Recent Profile Changes</h4>
                            <div class="audit-trail">
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="audit-details">
                                        <div class="audit-action">Bank account updated</div>
                                        <div class="audit-meta">by Finance Admin on 20 Dec 2024, 14:30</div>
                                    </div>
                                    <div class="audit-status">
                                        <span class="status-badge sensitive">Sensitive</span>
                                    </div>
                                </div>
                                
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="fas fa-user-edit"></i>
                                    </div>
                                    <div class="audit-details">
                                        <div class="audit-action">Travel preferences modified</div>
                                        <div class="audit-meta">by You on 18 Dec 2024, 09:15</div>
                                    </div>
                                    <div class="audit-status">
                                        <span class="status-badge normal">Normal</span>
                                    </div>
                                </div>
                                
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="audit-details">
                                        <div class="audit-action">Delegation settings changed</div>
                                        <div class="audit-meta">by You on 15 Dec 2024, 16:45</div>
                                    </div>
                                    <div class="audit-status">
                                        <span class="status-badge sensitive">Sensitive</span>
                                    </div>
                                </div>
                                
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div class="audit-details">
                                        <div class="audit-action">2FA enabled</div>
                                        <div class="audit-meta">by You on 10 Dec 2024, 11:20</div>
                                    </div>
                                    <div class="audit-status">
                                        <span class="status-badge security">Security</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="audit-actions">
                                <button class="btn-secondary" onclick="exportAuditLog()">Export Full Audit Log</button>
                            </div>
                        </div>
                        
                        <div class="last-updated">Last updated by System on 22 Dec 2024</div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="profile-card" id="security">
                    <div class="card-header">
                        <h3><i class="fas fa-shield-alt"></i> Security Settings</h3>
                    </div>
                    <div class="card-content">
                        <div class="security-actions">
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-key"></i>
                                    <div>
                                        <h4>Change Password</h4>
                                        <p>Update your account password</p>
                                    </div>
                                </div>
                                <button class="security-btn" onclick="changePassword()">Change</button>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-mobile-alt"></i>
                                    <div>
                                        <h4>Two-Factor Authentication</h4>
                                        <p>Authenticator App - Enrolled</p>
                                    </div>
                                </div>
                                <div class="security-actions-group">
                                    <button class="security-btn enabled" onclick="manage2FA()">Manage</button>
                                    <button class="security-btn secondary" onclick="showRecoveryCodes()">Show Recovery Codes</button>
                                    <button class="security-btn danger" onclick="regenerateRecoveryCodes()">Regenerate</button>
                                </div>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-devices"></i>
                                    <div>
                                        <h4>Active Sessions & Devices</h4>
                                        <p>3 active sessions</p>
                                    </div>
                                </div>
                                <button class="security-btn" onclick="manageDevices()">Manage</button>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-user-shield"></i>
                                    <div>
                                        <h4>Delegation / Out of Office</h4>
                                        <p>Set approval delegation</p>
                                    </div>
                                </div>
                                <button class="security-btn" onclick="manageDelegation()">Configure</button>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-download"></i>
                                    <div>
                                        <h4>Data Export & Privacy</h4>
                                        <p>Download your data or request account deactivation</p>
                                    </div>
                                </div>
                                <div class="security-actions-group">
                                    <button class="security-btn" onclick="exportData()">Export Data</button>
                                    <button class="security-btn danger" onclick="requestDeactivation()">Deactivate Account</button>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Last security review: 1 Dec 2024</div>
                    </div>
                </div>

                <!-- Active Sessions -->
                <div class="profile-card" id="sessions">
                    <div class="card-header">
                        <h3><i class="fas fa-devices"></i> Active Sessions & Devices</h3>
                    </div>
                    <div class="card-content">
                        <div class="sessions-list">
                            <div class="session-item current">
                                <div class="session-info">
                                    <div class="session-icon">
                                        <i class="fas fa-desktop"></i>
                                    </div>
                                    <div class="session-details">
                                        <span class="session-device">Windows 11 - Chrome</span>
                                        <span class="session-location">Jakarta, Indonesia</span>
                                        <span class="session-time">Current session</span>
                                    </div>
                                </div>
                                <span class="current-badge">Current</span>
                            </div>
                            
                            <div class="session-item">
                                <div class="session-info">
                                    <div class="session-icon">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                    <div class="session-details">
                                        <span class="session-device">iPhone 15 - Safari</span>
                                        <span class="session-location">Jakarta, Indonesia</span>
                                        <span class="session-time">2 hours ago</span>
                                    </div>
                                </div>
                                <button class="revoke-btn" onclick="revokeSession('mobile-1')">Sign Out</button>
                            </div>
                            
                            <div class="session-item">
                                <div class="session-info">
                                    <div class="session-icon">
                                        <i class="fas fa-laptop"></i>
                                    </div>
                                    <div class="session-details">
                                        <span class="session-device">MacBook Pro - Safari</span>
                                        <span class="session-location">Bandung, Indonesia</span>
                                        <span class="session-time">1 day ago</span>
                                    </div>
                                </div>
                                <button class="revoke-btn" onclick="revokeSession('laptop-1')">Sign Out</button>
                            </div>
                        </div>
                        
                        <div class="sessions-actions">
                            <button class="revoke-all-btn" onclick="revokeAllSessions()">
                                <i class="fas fa-sign-out-alt"></i>
                                Sign Out All Other Sessions
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Delegation Settings -->
                <div class="profile-card" id="delegation">
                    <div class="card-header">
                        <h3><i class="fas fa-user-shield"></i> Delegation / Out of Office</h3>
                        <div class="card-actions">
                            <button class="edit-btn" onclick="editDelegation()">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="end-delegation-btn" onclick="endDelegationEarly()">
                                <i class="fas fa-stop"></i> End Early
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="delegation-status">
                            <div class="status-indicator active">
                                <i class="fas fa-check-circle"></i>
                                <span>Delegation Active</span>
                            </div>
                            <div class="delegation-period">
                                <span>25 Dec 2024 - 2 Jan 2025</span>
                            </div>
                            <div class="delegation-preview">
                                <div class="preview-box">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Requests will be routed to @Sarah Johnson between 25 Dec - 2 Jan</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="delegation-details">
                            <div class="delegate-info">
                                <div class="delegate-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="delegate-details">
                                    <span class="delegate-name">Sarah Johnson</span>
                                    <span class="delegate-role">Senior Manager</span>
                                    <span class="delegate-email">sarah.johnson@company.com</span>
                                </div>
                            </div>
                            
                            <div class="delegation-scope">
                                <h4>Delegation Scope</h4>
                                <div class="scope-items">
                                    <div class="scope-item">
                                        <i class="fas fa-check"></i>
                                        <span>Expense Approvals</span>
                                    </div>
                                    <div class="scope-item">
                                        <i class="fas fa-check"></i>
                                        <span>Travel Requests</span>
                                    </div>
                                    <div class="scope-item">
                                        <i class="fas fa-check"></i>
                                        <span>Budget Adjustments</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="delegation-notifications">
                                <h4>Notifications</h4>
                                <div class="notification-settings">
                                    <div class="notification-item">
                                        <span>Notify delegate of new approvals</span>
                                        <div class="toggle-switch active">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </div>
                                    </div>
                                    <div class="notification-item">
                                        <span>Send me delegation summary</span>
                                        <div class="toggle-switch active">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="last-updated">Delegation set by John Doe on 20 Dec 2024</div>
                    </div>
                </div>

                <!-- App Settings -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-mobile-alt"></i> App Settings</h3>
                    </div>
                    <div class="card-content">
                        <div class="app-settings">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <span class="setting-title">Dark Mode</span>
                                    <span class="setting-desc">Use dark theme for the app</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <span class="setting-title">Auto-sync</span>
                                    <span class="setting-desc">Automatically sync data when online</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <span class="setting-title">Offline Mode</span>
                                    <span class="setting-desc">Allow app to work offline</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logout Section -->
                <div class="profile-card logout-section">
                    <div class="card-content">
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        function changePhoto() {
            alert('Photo change feature coming soon!');
        }
        
        function editPersonalInfo() {
            alert('Personal information edit feature coming soon!');
        }
        
        function editTravelPrefs() {
            alert('Travel preferences edit feature coming soon!');
        }
        
        function changePassword() {
            alert('Change password feature coming soon!');
        }
        
        function enable2FA() {
            alert('Two-Factor Authentication feature coming soon!');
        }
        
        function viewLoginHistory() {
            alert('Login history feature coming soon!');
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear user session
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('loginTime');
                
                // Redirect to login page
                window.location.href = 'login.html';
            }
        }
        
        // Integration functions
        function reconnectIntegration(integrationName) {
            alert(`Reconnecting to ${integrationName}...`);
            // Simulate reconnection process
            setTimeout(() => {
                alert(`Successfully reconnected to ${integrationName}!`);
                location.reload();
            }, 2000);
        }
        
        // MWP Tools functions
        function downloadMWPTemplate() {
            alert('Downloading MWP template...');
            // Create a dummy download
            const link = document.createElement('a');
            link.href = 'data:text/plain;charset=utf-8,MWP Template Content';
            link.download = 'mwp-template.xlsx';
            link.click();
        }
        
        function uploadMWPTemplate() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.xlsx,.xls,.csv';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    alert(`Uploading ${file.name}...`);
                    // Simulate upload process
                    setTimeout(() => {
                        alert('MWP template uploaded successfully!');
                    }, 2000);
                }
            };
            input.click();
        }
        
        function viewMWPStatus() {
            alert('Redirecting to MWP status page...');
            window.location.href = 'mwp.html';
        }
        
        // 2FA functions
        function showRecoveryCodes() {
            // Show recovery codes in a modal
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000';
            
            const content = document.createElement('div');
            content.style.cssText = 'background:white;padding:30px;border-radius:10px;max-width:400px;width:90%';
            content.innerHTML = `
                <h3 style="margin-top:0">Recovery Codes</h3>
                <p style="color:#666;margin-bottom:20px">Save these codes in a secure location. Each code can only be used once.</p>
                <div style="background:#f8f9fa;padding:15px;border-radius:5px;font-family:monospace;margin-bottom:20px">
                    ABC123<br>DEF456<br>GHI789<br>JKL012<br>MNO345<br>PQR678<br>STU901<br>VWX234
                </div>
                <button onclick="this.parentElement.parentElement.remove()" style="background:#667eea;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Close</button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }
        
        function regenerateRecoveryCodes() {
            if (confirm('Are you sure you want to regenerate recovery codes? This will:\n\n• Invalidate all existing codes\n• Force re-login on all sessions\n• Require you to log in again')) {
                alert('Generating new recovery codes and signing out all sessions...');
                // Simulate code generation and force logout
                setTimeout(() => {
                    const codes = ['XYZ789', 'ABC012', 'DEF345', 'GHI678', 'JKL901', 'MNO234', 'PQR567', 'STU890'];
                    alert(`New recovery codes generated:\n${codes.join('\n')}\n\nPlease save these codes securely.\n\nYou will now be logged out from all sessions.`);
                    
                    // Force logout after showing codes
                    setTimeout(() => {
                        localStorage.removeItem('isLoggedIn');
                        localStorage.removeItem('userEmail');
                        window.location.href = 'login.html';
                    }, 3000);
                }, 1500);
            }
        }
        
        // Session management functions
        function signOutOtherSessions() {
            if (confirm('Are you sure you want to sign out all other sessions?')) {
                alert('Signing out other sessions...');
                setTimeout(() => {
                    alert('All other sessions have been signed out successfully!');
                    location.reload();
                }, 2000);
            }
        }
        
        // Delegation functions
        function setDelegate() {
            const delegate = prompt('Enter delegate email:');
            const startDate = prompt('Enter start date (YYYY-MM-DD):');
            const endDate = prompt('Enter end date (YYYY-MM-DD):');
            
            if (delegate && startDate && endDate) {
                alert(`Delegation set:\nDelegate: ${delegate}\nPeriod: ${startDate} to ${endDate}`);
            }
        }
        
        // Data export functions
        function downloadUserData() {
            if (confirm('Download your personal data? This may take a few minutes to prepare.')) {
                alert('Preparing your data export...');
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify({
                        user: 'John Doe',
                        email: 'john.doe@company.com',
                        exportDate: new Date().toISOString(),
                        data: 'User profile and activity data'
                    }, null, 2));
                    link.download = 'my-data-export.json';
                    link.click();
                    alert('Data export downloaded successfully!');
                }, 3000);
            }
        }
        
        function requestAccountDeactivation() {
            if (confirm('Are you sure you want to request account deactivation? This action requires admin approval.')) {
                alert('Account deactivation request submitted. You will receive an email confirmation.');
            }
        }
        
        // Audit trail functions
        function exportAuditLog() {
            alert('Preparing audit log export...');
            setTimeout(() => {
                const link = document.createElement('a');
                link.href = 'data:text/csv;charset=utf-8,Date,Action,User,Status\n2024-12-22,Bank account updated,John Doe,Completed\n2024-12-18,Travel preferences modified,John Doe,Completed';
                link.download = 'audit-log.csv';
                link.click();
                alert('Audit log exported successfully!');
            }, 2000);
        }
        
        // Sensitive data reveal function
          function revealSensitiveData(fieldId, actualValue) {
              const element = document.getElementById(fieldId);
              const revealBtn = element.nextElementSibling.querySelector('.reveal-btn');
              
              // Show actual value
              element.textContent = actualValue;
              revealBtn.innerHTML = '<i class="fas fa-eye-slash"></i> Hide';
              revealBtn.disabled = true;
              
              // Hide after 5 seconds
              setTimeout(() => {
                  if (fieldId === 'accountNumber') {
                      element.textContent = '**** **** **** 4321';
                  } else if (fieldId === 'taxId') {
                      element.textContent = '**.***.***.*-***.***';
                  }
                  revealBtn.innerHTML = '<i class="fas fa-eye"></i> Reveal';
                  revealBtn.disabled = false;
              }, 5000);
          }
          
          // Inline validation functions
          function validateIBAN(iban) {
              const ibanRegex = /^[A-Z]{2}[0-9]{2}[A-Z0-9]{4}[0-9]{7}([A-Z0-9]?){0,16}$/;
              return ibanRegex.test(iban.replace(/\s/g, ''));
          }
          
          function validateSWIFT(swift) {
              const swiftRegex = /^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$/;
              return swiftRegex.test(swift);
          }
          
          function validateNPWP(npwp) {
              const npwpRegex = /^[0-9]{2}\.[0-9]{3}\.[0-9]{3}\.[0-9]{1}-[0-9]{3}\.[0-9]{3}$/;
              return npwpRegex.test(npwp);
          }
          
          function validatePhone(phone) {
              const phoneRegex = /^(\+62|62|0)[0-9]{9,12}$/;
              return phoneRegex.test(phone.replace(/[\s-]/g, ''));
          }
          
          function calculateSimilarity(str1, str2) {
              const longer = str1.length > str2.length ? str1 : str2;
              const shorter = str1.length > str2.length ? str2 : str1;
              const editDistance = levenshteinDistance(longer, shorter);
              return (longer.length - editDistance) / longer.length;
          }
          
          function levenshteinDistance(str1, str2) {
              const matrix = [];
              for (let i = 0; i <= str2.length; i++) {
                  matrix[i] = [i];
              }
              for (let j = 0; j <= str1.length; j++) {
                  matrix[0][j] = j;
              }
              for (let i = 1; i <= str2.length; i++) {
                  for (let j = 1; j <= str1.length; j++) {
                      if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                          matrix[i][j] = matrix[i - 1][j - 1];
                      } else {
                          matrix[i][j] = Math.min(
                              matrix[i - 1][j - 1] + 1,
                              matrix[i][j - 1] + 1,
                              matrix[i - 1][j] + 1
                          );
                      }
                  }
              }
              return matrix[str2.length][str1.length];
          }
          
          function showValidationError(fieldId, message) {
              const field = document.getElementById(fieldId);
              let errorDiv = field.parentNode.querySelector('.validation-error');
              
              if (!errorDiv) {
                  errorDiv = document.createElement('div');
                  errorDiv.className = 'validation-error';
                  field.parentNode.appendChild(errorDiv);
              }
              
              errorDiv.textContent = message;
              errorDiv.style.display = 'block';
              field.style.borderColor = '#dc3545';
          }
          
          function clearValidationError(fieldId) {
              const field = document.getElementById(fieldId);
              const errorDiv = field.parentNode.querySelector('.validation-error');
              
              if (errorDiv) {
                  errorDiv.style.display = 'none';
              }
              field.style.borderColor = '#dee2e6';
          }
          
          function validateField(fieldId, value) {
              switch(fieldId) {
                  case 'bankAccount':
                      if (!validateIBAN(value) && !validateSWIFT(value)) {
                          showValidationError(fieldId, 'Format IBAN atau SWIFT tidak valid');
                          return false;
                      }
                      break;
                  case 'taxId':
                      if (!validateNPWP(value)) {
                          showValidationError(fieldId, 'Format NPWP tidak valid (XX.XXX.XXX.X-XXX.XXX)');
                          return false;
                      }
                      break;
                  case 'accountHolder':
                      const employeeName = 'John Doe'; // This should come from user data
                      const similarity = calculateSimilarity(value.toLowerCase(), employeeName.toLowerCase());
                      if (similarity < 0.7) {
                          showValidationError(fieldId, 'Nama rekening harus mirip dengan nama karyawan');
                          return false;
                      }
                      break;
                  case 'phone':
                      if (!validatePhone(value)) {
                          showValidationError(fieldId, 'Format nomor telepon tidak valid');
                          return false;
                      }
                      break;
              }
              clearValidationError(fieldId);
              return true;
          }
         
         // Test notification functions
         function testEmailNotification() {
             alert('Test email notification sent to john.doe@company.com');
         }
         
         function testPushNotification() {
             alert('Test push notification sent to your devices');
         }
         
         function testSlackNotification() {
             alert('Test Slack notification sent to #travel-expenses channel');
         }
         
         // Integration functions
         function viewIntegrationLogs(integration) {
             alert(`Viewing ${integration} integration logs...\n\nLast 10 events:\n• Sync completed - 2 hours ago\n• Data updated - 4 hours ago\n• Connection verified - 1 day ago`);
         }
         
         // MWP functions
         function openValidationResults() {
             alert('Opening MWP validation results page...');
             window.open('mwp-validation.html', '_blank');
         }
         
         // Delegation functions
         function endDelegationEarly() {
             if (confirm('Are you sure you want to end the delegation early?')) {
                 alert('Delegation ended successfully. Audit entry created.');
                 location.reload();
             }
         }
         
         // Sticky navigation active state
         document.addEventListener('DOMContentLoaded', function() {
             const sections = document.querySelectorAll('.profile-card[id]');
             const navLinks = document.querySelectorAll('.subnav a');
             
             function updateActiveNav() {
                 let current = '';
                 sections.forEach(section => {
                     const sectionTop = section.offsetTop - 100;
                     if (window.pageYOffset >= sectionTop) {
                         current = section.getAttribute('id');
                     }
                 });
                 
                 navLinks.forEach(link => {
                     link.classList.remove('active');
                     if (link.getAttribute('href') === '#' + current) {
                         link.classList.add('active');
                     }
                 });
             }
             
             window.addEventListener('scroll', updateActiveNav);
             updateActiveNav();
         });
         
         // Smooth scroll for navigation links
           document.querySelectorAll('.subnav a').forEach(link => {
               link.addEventListener('click', function(e) {
                   e.preventDefault();
                   const targetId = this.getAttribute('href').substring(1);
                   const targetElement = document.getElementById(targetId);
                   if (targetElement) {
                       targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                   }
               });
           });
           
           // Re-authentication for sensitive data changes
           function requireReAuth(callback) {
               const modal = document.createElement('div');
               modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000';
               
               const content = document.createElement('div');
               content.style.cssText = 'background:white;padding:30px;border-radius:10px;max-width:400px;width:90%';
               content.innerHTML = `
                   <h3 style="margin-top:0">Konfirmasi Identitas</h3>
                   <p style="color:#666;margin-bottom:20px">Masukkan password untuk mengonfirmasi perubahan data sensitif.</p>
                   <input type="password" id="reAuthPassword" placeholder="Password" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:15px">
                   <div style="display:flex;gap:10px;justify-content:flex-end">
                       <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background:#6c757d;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Batal</button>
                       <button onclick="confirmReAuth()" style="background:#667eea;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Konfirmasi</button>
                   </div>
               `;
               
               modal.appendChild(content);
               document.body.appendChild(modal);
               
               window.confirmReAuth = function() {
                   const password = document.getElementById('reAuthPassword').value;
                   if (password === 'password123') { // Mock validation
                       modal.remove();
                       callback();
                       showToast('Perubahan berhasil disimpan', 'success');
                   } else {
                       showToast('Password salah', 'error');
                   }
               };
           }
           
           // Toast notification function
           function showToast(message, type = 'success') {
               const toast = document.createElement('div');
               toast.className = `toast ${type}`;
               toast.textContent = message;
               document.body.appendChild(toast);
               
               setTimeout(() => toast.classList.add('show'), 100);
               setTimeout(() => {
                   toast.classList.remove('show');
                   setTimeout(() => toast.remove(), 300);
               }, 3000);
           }
           
           // Back to top functionality
           function initBackToTop() {
               const backToTopBtn = document.createElement('button');
               backToTopBtn.className = 'back-to-top';
               backToTopBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
               backToTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
               document.body.appendChild(backToTopBtn);
               
               window.addEventListener('scroll', () => {
                   if (window.pageYOffset > 300) {
                       backToTopBtn.classList.add('show');
                   } else {
                       backToTopBtn.classList.remove('show');
                   }
               });
           }
           
           // Session management with warnings
           function checkOldSessions() {
               const sessions = [
                   { device: 'Windows 11 - Chrome', lastActive: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000) },
                   { device: 'iPhone 13 - Safari', lastActive: new Date(Date.now() - 35 * 24 * 60 * 60 * 1000) },
                   { device: 'MacBook - Firefox', lastActive: new Date(Date.now() - 45 * 24 * 60 * 60 * 1000) }
               ];
               
               const oldSessions = sessions.filter(session => {
                   const daysDiff = (Date.now() - session.lastActive.getTime()) / (1000 * 60 * 60 * 24);
                   return daysDiff > 30;
               });
               
               if (oldSessions.length > 0) {
                   const message = `Peringatan: ${oldSessions.length} sesi aktif lebih dari 30 hari. Disarankan untuk sign out.`;
                   showToast(message, 'error');
               }
           }
           
           // Initialize all functions on page load
           document.addEventListener('DOMContentLoaded', function() {
               initBackToTop();
               checkOldSessions();
               
               // Add validation to form fields
               const fieldsToValidate = ['bankAccount', 'taxId', 'accountHolder', 'phone'];
               fieldsToValidate.forEach(fieldId => {
                   const field = document.getElementById(fieldId);
                   if (field) {
                       field.addEventListener('blur', function() {
                           validateField(fieldId, this.value);
                       });
                   }
               });
           });
           
           // Save sensitive data with re-auth
           function saveSensitiveData(fieldType, value) {
               requireReAuth(() => {
                   // Mock save operation
                   console.log(`Saving ${fieldType}: ${value}`);
               });
           }
           
           // Edit sensitive field with modal
           function editSensitiveField(fieldId, fieldName) {
               const modal = document.createElement('div');
               modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000';
               
               const content = document.createElement('div');
               content.style.cssText = 'background:white;padding:30px;border-radius:10px;max-width:500px;width:90%';
               content.innerHTML = `
                   <h3 style="margin-top:0">Edit ${fieldName}</h3>
                   <p style="color:#666;margin-bottom:20px">Masukkan nilai baru untuk ${fieldName.toLowerCase()}.</p>
                   <input type="text" id="newSensitiveValue" placeholder="${fieldName}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:15px">
                   <div class="validation-error" style="color:#dc3545;font-size:14px;margin-bottom:15px;display:none"></div>
                   <div style="display:flex;gap:10px;justify-content:flex-end">
                       <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background:#6c757d;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Batal</button>
                       <button onclick="saveSensitiveFieldValue('${fieldId}', '${fieldName}')" style="background:#667eea;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Simpan</button>
                   </div>
               `;
               
               modal.appendChild(content);
               document.body.appendChild(modal);
               
               // Focus on input
               setTimeout(() => {
                   document.getElementById('newSensitiveValue').focus();
               }, 100);
           }
           
           // Save sensitive field value with validation and re-auth
           function saveSensitiveFieldValue(fieldId, fieldName) {
               const newValue = document.getElementById('newSensitiveValue').value;
               const errorDiv = document.querySelector('.validation-error');
               
               // Validate the input
               if (!validateField(fieldId, newValue)) {
                   return; // Validation failed, error already shown
               }
               
               // Close modal and require re-auth
               document.querySelector('[style*="position:fixed"]').remove();
               
               requireReAuth(() => {
                   // Update the masked display
                   const element = document.getElementById(fieldId);
                   if (fieldId === 'bankAccount') {
                       element.textContent = '****-****-' + newValue.slice(-4);
                   } else if (fieldId === 'taxId') {
                       element.textContent = '**.***.***.*-***.***';
                   }
                   
                   showToast(`${fieldName} berhasil diperbarui`, 'success');
                   
                   // Update last modified info
                   const lastUpdated = element.closest('.profile-card').querySelector('.last-updated');
                   if (lastUpdated) {
                       lastUpdated.textContent = `Last updated by John Doe on ${new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })}`;
                   }
               });
           }
    </script>
    
    <style>
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .profile-avatar {
            position: relative;
        }
        
        .profile-avatar img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #667eea;
        }
        
        .change-photo-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .profile-info h1 {
            color: #333;
            margin-bottom: 5px;
            font-size: 1.8rem;
        }
        
        .job-title {
            color: #667eea;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .department {
            color: #666;
            margin-bottom: 5px;
        }
        
        .employee-id {
            color: #999;
            font-size: 0.9rem;
            font-family: monospace;
        }
        
        .profile-stats {
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #f0f4ff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-icon i {
            color: #667eea;
            font-size: 1.2rem;
        }
        
        .stat-content {
            display: flex;
            flex-direction: column;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .profile-sections {
            display: grid;
            gap: 20px;
        }
        
        .profile-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .card-header h3 {
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            font-size: 1.2rem;
        }
        
        .edit-btn {
            background: #f8f9fa;
            color: #667eea;
            border: 1px solid #dee2e6;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .edit-btn:hover {
            background: #e9ecef;
        }
        
        .card-content {
            padding: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .info-item label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .info-item span {
            color: #333;
            font-size: 1rem;
        }
        
        .budget-overview {
            display: grid;
            gap: 20px;
        }
        
        .budget-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .budget-title {
            color: #333;
            font-weight: 500;
        }
        
        .budget-amount {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .budget-progress {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            color: #666;
            font-size: 0.9rem;
        }
        
        .notification-settings, .app-settings {
            display: grid;
            gap: 15px;
        }
        
        .notification-matrix {
            margin-bottom: 30px;
        }
        
        .matrix-header {
            display: grid;
            grid-template-columns: 1fr 200px;
            align-items: center;
            padding: 15px 0;
            border-bottom: 2px solid #e0e0e0;
            font-weight: 600;
            color: #333;
        }
        
        .matrix-channels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
        }
        
        .channel-header {
            font-size: 14px;
            color: #666;
        }
        
        .matrix-row {
            display: grid;
            grid-template-columns: 1fr 200px;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .matrix-row:last-child {
            border-bottom: none;
        }
        
        .matrix-label {
            display: flex;
            flex-direction: column;
        }
        
        .notification-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }
        
        .notification-desc {
            font-size: 14px;
            color: #666;
        }
        
        .toggle-switch.mini {
            transform: scale(0.8);
        }
        
        .notification-schedule {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .notification-schedule h4 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 16px;
        }
        
        .schedule-settings {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .schedule-info {
            display: flex;
            flex-direction: column;
        }
        
        .schedule-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }
        
        .schedule-desc {
            font-size: 14px;
            color: #666;
        }
        
        .time-range {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-select, .digest-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            color: #333;
        }
        
        .time-range span {
            color: #666;
            font-size: 14px;
        }
        
        .last-updated {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 12px;
            color: #999;
            text-align: right;
        }
        
        .permissions-section, .audit-section {
            margin-bottom: 30px;
        }
        
        .permissions-section h4, .audit-section h4 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 16px;
        }
        
        .permissions-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .permission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .permission-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .permission-field {
            font-weight: 500;
            color: #333;
        }
        
        .permission-desc {
            font-size: 14px;
            color: #666;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge.editable {
            background: #d4edda;
            color: #155724;
        }
        
        .badge.managed {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge.restricted {
            background: #f8d7da;
            color: #721c24;
        }
        
        .audit-trail {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .audit-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .audit-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .audit-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .audit-action {
            font-weight: 500;
            color: #333;
        }
        
        .audit-meta {
            font-size: 14px;
            color: #666;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .status-badge.sensitive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-badge.normal {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-badge.security {
            background: #d4edda;
            color: #155724;
        }
        
        .audit-actions {
            display: flex;
            justify-content: flex-end;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .setting-title {
            color: #333;
            font-weight: 500;
        }
        
        .setting-desc {
            color: #666;
            font-size: 0.9rem;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .security-actions {
            display: grid;
            gap: 10px;
        }
        
        .security-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            width: 100%;
        }
        
        .security-btn:hover {
            background: #e9ecef;
        }
        
        .security-btn i:first-child {
            color: #667eea;
            font-size: 1.2rem;
            width: 20px;
        }
        
        .btn-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .btn-title {
            color: #333;
            font-weight: 500;
        }
        
        .btn-desc {
            color: #666;
            font-size: 0.9rem;
        }
        
        .security-btn i:last-child {
            color: #999;
        }
        
        .logout-section {
            border: 1px solid #dc3545;
        }
        
        .logout-btn {
            width: 100%;
            padding: 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: #c82333;
        }
        
        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .card-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .budget-header {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }
            
            .setting-item {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }
        
        /* Sticky Sub Navigation */
        .subnav {
            position: sticky;
            top: 64px;
            z-index: 10;
            background: #fff;
            border: 1px solid #e5e9f2;
            border-radius: 10px;
            padding: 6px 8px;
            display: flex;
            gap: 8px;
            overflow: auto;
            margin-bottom: 20px;
        }
        
        .subnav a {
            padding: 6px 10px;
            border-radius: 8px;
            text-decoration: none;
            color: #666;
            font-size: 0.9rem;
            white-space: nowrap;
            transition: all 0.2s ease;
        }
        
        .subnav a:hover {
            background: #f8f9fa;
        }
        
        .subnav a.active {
            background: #eef2ff;
            font-weight: 700;
            color: #667eea;
        }
        
        /* Admin Badge */
        .badge-admin {
            font-size: 0.75rem;
            padding: 4px 8px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 999px;
            color: #856404;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .badge-admin i {
            font-size: 0.7rem;
        }
        
        /* Locked State Styling */
        .info-grid.locked,
        .budget-overview.locked {
            opacity: 0.8;
            pointer-events: none;
        }
        
        .info-item.locked {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
        }
        
        .info-item.locked label {
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .info-item.locked span {
            color: #6c757d;
        }
        
        .lock-icon {
            font-size: 0.7rem;
            color: #adb5bd;
        }

        .tooltip-icon {
            color: #6b7280;
            font-size: 12px;
            margin-left: 4px;
            cursor: help;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .tooltip-icon:hover {
            opacity: 1;
            color: #3b82f6;
        }
        
        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .skeleton-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .skeleton-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }
        
        .skeleton-title {
            height: 20px;
            width: 150px;
            border-radius: 4px;
        }
        
        .skeleton-line {
            height: 16px;
            border-radius: 4px;
            margin-bottom: 12px;
        }
        
        .skeleton-line.short { width: 60%; }
        .skeleton-line.medium { width: 80%; }
        .skeleton-line.long { width: 100%; }
        
        .skeleton-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .skeleton-item {
            padding: 16px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        .skeleton-item .skeleton-line:first-child {
            width: 40%;
            margin-bottom: 8px;
        }
        
        .skeleton-item .skeleton-line:last-child {
            width: 70%;
            margin-bottom: 0;
        }
        
        /* Sensitive Data Styling */
        .reveal-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            color: #667eea;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reveal-btn:hover {
            background: #e9ecef;
        }
        
        .reveal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .helper-text {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 4px;
        }
        
        /* Last Updated Styling */
        .last-updated {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        
        /* Security Button Styling */
        .security-btn.danger {
            background: #fee;
            border-color: #fcc;
            color: #c33;
        }
        
        .security-btn.danger:hover {
            background: #fdd;
        }
        
        /* Test Notification Buttons */
        .test-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            color: #667eea;
            cursor: pointer;
            margin-left: 8px;
        }
        
        .test-btn:hover {
            background: #e9ecef;
        }
        
        /* Delegation Preview */
        .delegation-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .delegation-preview h5 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 0.9rem;
        }
        
        .delegation-flow {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .delegation-flow .arrow {
             color: #667eea;
         }
         
         /* Validation Error Styling */
         .validation-error {
             display: none;
             color: #dc3545;
             font-size: 0.8rem;
             margin-top: 4px;
             padding: 4px 8px;
             background: #f8d7da;
             border: 1px solid #f5c6cb;
             border-radius: 4px;
         }
         
         /* Disabled field styling */
         .info-item input:disabled,
         .info-item select:disabled {
             background-color: #f8f9fa;
             color: #6c757d;
             cursor: not-allowed;
             opacity: 0.7;
         }
         
         /* Tooltip styling */
         .tooltip {
             position: relative;
             display: inline-block;
             cursor: help;
         }
         
         .tooltip .tooltiptext {
             visibility: hidden;
             width: 200px;
             background-color: #333;
             color: #fff;
             text-align: center;
             border-radius: 6px;
             padding: 8px;
             position: absolute;
             z-index: 1;
             bottom: 125%;
             left: 50%;
             margin-left: -100px;
             font-size: 0.8rem;
             opacity: 0;
             transition: opacity 0.3s;
         }
         
         .tooltip:hover .tooltiptext {
             visibility: visible;
             opacity: 1;
         }
         
         /* Toast notification */
         .toast {
             position: fixed;
             top: 20px;
             right: 20px;
             padding: 12px 20px;
             border-radius: 8px;
             color: white;
             font-weight: 500;
             z-index: 1000;
             transform: translateX(400px);
             transition: transform 0.3s ease;
         }
         
         .toast.success {
             background-color: #28a745;
         }
         
         .toast.error {
             background-color: #dc3545;
         }
         
         .toast.show {
             transform: translateX(0);
         }
         
         /* Back to top button */
         .back-to-top {
             position: fixed;
             bottom: 20px;
             right: 20px;
             width: 50px;
             height: 50px;
             background: #667eea;
             color: white;
             border: none;
             border-radius: 50%;
             cursor: pointer;
             display: none;
             align-items: center;
             justify-content: center;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
             transition: all 0.3s ease;
         }
         
         .back-to-top:hover {
             background: #5a67d8;
             transform: translateY(-2px);
         }
         
         .back-to-top.show {
             display: flex;
         }
         
         /* Toast notifications */
         .toast {
             position: fixed;
             top: 20px;
             right: 20px;
             padding: 15px 20px;
             border-radius: 8px;
             color: white;
             font-weight: 500;
             z-index: 1001;
             transform: translateX(400px);
             transition: transform 0.3s ease;
             max-width: 300px;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
         }
         
         .toast.show {
             transform: translateX(0);
         }
         
         .toast.success {
             background: #10b981;
         }
         
         .toast.error {
             background: #ef4444;
         }
         
         .toast.warning {
             background: #f59e0b;
         }
         
         .toast.info {
             background: #3b82f6;
         }
         
         /* Sensitive data styling */
         .sensitive-data {
             display: flex;
             align-items: center;
             gap: 10px;
             flex-wrap: wrap;
         }
         
         .btn-secondary {
             background: #6c757d;
             color: white;
             border: none;
             padding: 6px 12px;
             border-radius: 4px;
             cursor: pointer;
             font-size: 12px;
             transition: background-color 0.2s;
         }
         
         .btn-secondary:hover {
             background: #5a6268;
         }
         
         .btn-secondary i {
             margin-right: 4px;
         }
         
         /* Modal styling improvements */
         .modal-overlay {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0,0,0,0.5);
             display: flex;
             align-items: center;
             justify-content: center;
             z-index: 1000;
         }
         
         .modal-content {
             background: white;
             padding: 30px;
             border-radius: 10px;
             max-width: 500px;
             width: 90%;
             box-shadow: 0 10px 25px rgba(0,0,0,0.2);
         }
         
         .modal-input {
             width: 100%;
             padding: 10px;
             border: 1px solid #ddd;
             border-radius: 5px;
             margin-bottom: 15px;
             font-size: 14px;
         }
         
         .modal-input:focus {
             outline: none;
             border-color: #667eea;
             box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
         }
         
         .modal-buttons {
             display: flex;
             gap: 10px;
             justify-content: flex-end;
         }
         
         .modal-btn {
             border: none;
             padding: 10px 20px;
             border-radius: 5px;
             cursor: pointer;
             font-weight: 500;
             transition: all 0.2s;
         }
         
         .modal-btn.cancel {
             background: #6c757d;
             color: white;
         }
         
         .modal-btn.cancel:hover {
             background: #5a6268;
         }
         
         .modal-btn.primary {
             background: #667eea;
             color: white;
         }
         
         .modal-btn.primary:hover {
             background: #5a67d8;
         }
    </style>
    
    <script>
        // Guard against unsaved changes
        let hasUnsavedChanges = false;
        
        // Track form changes
        document.addEventListener('input', function(e) {
            if (e.target.matches('input, textarea, select')) {
                hasUnsavedChanges = true;
            }
        });
        
        // Warn before leaving page with unsaved changes
        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
        
        // Reset unsaved changes flag when form is saved
        function markAsSaved() {
            hasUnsavedChanges = false;
        }
        
        // Add to existing save functions
        const originalSaveSensitiveFieldValue = saveSensitiveFieldValue;
        saveSensitiveFieldValue = function(fieldId, fieldName) {
            originalSaveSensitiveFieldValue(fieldId, fieldName);
            markAsSaved();
        };
        
        // Skeleton loading functions
        function showSkeleton(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const skeletonHTML = `
                <div class="skeleton-card">
                    <div class="skeleton-header">
                        <div class="skeleton skeleton-icon"></div>
                        <div class="skeleton skeleton-title"></div>
                    </div>
                    <div class="skeleton-grid">
                        <div class="skeleton-item">
                            <div class="skeleton skeleton-line short"></div>
                            <div class="skeleton skeleton-line medium"></div>
                        </div>
                        <div class="skeleton-item">
                            <div class="skeleton skeleton-line short"></div>
                            <div class="skeleton skeleton-line medium"></div>
                        </div>
                        <div class="skeleton-item">
                            <div class="skeleton skeleton-line short"></div>
                            <div class="skeleton skeleton-line medium"></div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = skeletonHTML;
        }
        
        function hideSkeleton(containerId, originalContent) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = originalContent;
        }
        
        // Simulate loading data with skeleton
        function loadSectionData(sectionId) {
            const section = document.getElementById(sectionId);
            if (!section) return;
            
            const originalContent = section.innerHTML;
            showSkeleton(sectionId);
            
            // Simulate API call delay
            setTimeout(() => {
                hideSkeleton(sectionId, originalContent);
            }, 1500);
        }
        
        // Show skeleton on initial page load
        document.addEventListener('DOMContentLoaded', function() {
            // Show toast notification for successful load
            setTimeout(() => {
                showToast('Profile data loaded successfully', 'success');
            }, 1600);
        });
    </script>
</body>
</html>