<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meals Caps Configuration - TrevID</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <img 
                    class="brand-logo" 
                    src="assets/brand/trevid_logo.png" 
                    srcset="/assets/brand/trevid_logo.png 1x, /assets/brand/trevid_logo@2x.png 2x" 
                    alt="TrevID â€“ Business Companion" 
                    width="140" height="36" />
            </div>
            <div class="user-info">
                <span>Hello, Admin User</span>
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </header>

    <div class="container-fluid mt-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="admin-breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="admin.html">Admin</a></li>
                <li class="breadcrumb-item"><a href="admin.html">Policies</a></li>
                <li class="breadcrumb-item active" aria-current="page">Meals Caps</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="admin-page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-utensils"></i>Meals Caps Configuration</h1>
                    <p>Configure meal allowance limits by location, type, and employee level</p>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#mealCapModal">
                    <i class="fas fa-plus me-2"></i>Add Meal Cap
                </button>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="card admin-filter-card">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-2">
                        <label class="form-label">Location</label>
                        <select class="form-select" id="filterLocation">
                            <option value="">All Locations</option>
                            <option value="jakarta">Jakarta</option>
                            <option value="surabaya">Surabaya</option>
                            <option value="bandung">Bandung</option>
                            <option value="bali">Bali</option>
                            <option value="singapore">Singapore</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Meal Type</label>
                        <select class="form-select" id="filterMealType">
                            <option value="">All Meal Types</option>
                            <option value="breakfast">Breakfast</option>
                            <option value="lunch">Lunch</option>
                            <option value="dinner">Dinner</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Employee Level</label>
                        <select class="form-select" id="filterEmployeeLevel">
                            <option value="">All Levels</option>
                            <option value="staff">Staff</option>
                            <option value="supervisor">Supervisor</option>
                            <option value="manager">Manager</option>
                            <option value="director">Director</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="filterStatus">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Search</label>
                        <input type="text" class="form-control" id="searchInput" placeholder="Search location or meal type...">
                    </div>
                </div>
            </div>
        </div>

        <!-- Meal Caps Table -->
        <div class="card admin-table-card">
            <div class="card-header">
                <h5 class="card-title mb-0">Meal Caps</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="mealCapsTable">
                        <thead>
                            <tr>
                                <th>Location</th>
                                <th>Meal Type</th>
                                <th>Employee Level</th>
                                <th>Max Amount (IDR)</th>
                                <th>Currency</th>
                                <th>Effective Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="mealCapsTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Meal Cap Modal -->
    <div class="modal fade" id="mealCapModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mealCapModalTitle">Add Meal Cap</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="mealCapForm">
                        <input type="hidden" id="mealCapId">
                        <div class="mb-3">
                            <label class="form-label">Location *</label>
                            <select class="form-select" id="mealCapLocation" required>
                                <option value="">Select Location</option>
                                <option value="jakarta">Jakarta</option>
                                <option value="surabaya">Surabaya</option>
                                <option value="bandung">Bandung</option>
                                <option value="bali">Bali</option>
                                <option value="singapore">Singapore</option>
                                <option value="kuala-lumpur">Kuala Lumpur</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Meal Type *</label>
                            <select class="form-select" id="mealCapMealType" required>
                                <option value="">Select Meal Type</option>
                                <option value="breakfast">Breakfast</option>
                                <option value="lunch">Lunch</option>
                                <option value="dinner">Dinner</option>
                                <option value="snack">Snack</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Employee Level *</label>
                            <select class="form-select" id="mealCapEmployeeLevel" required>
                                <option value="">Select Employee Level</option>
                                <option value="staff">Staff</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="manager">Manager</option>
                                <option value="director">Director</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Maximum Amount *</label>
                            <input type="number" class="form-control" id="mealCapAmount" required min="0" step="1000">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Currency *</label>
                            <select class="form-select" id="mealCapCurrency" required>
                                <option value="IDR">IDR - Indonesian Rupiah</option>
                                <option value="USD">USD - US Dollar</option>
                                <option value="SGD">SGD - Singapore Dollar</option>
                                <option value="MYR">MYR - Malaysian Ringgit</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Effective Date *</label>
                            <input type="date" class="form-control" id="mealCapEffectiveDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="mealCapStatus">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="mealCapNotes" rows="3" placeholder="Additional notes or conditions..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveMealCap()">Save Meal Cap</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample meal caps data
        let mealCaps = [
            {
                id: 1,
                location: 'jakarta',
                locationName: 'Jakarta',
                mealType: 'breakfast',
                mealTypeName: 'Breakfast',
                employeeLevel: 'staff',
                employeeLevelName: 'Staff',
                amount: 50000,
                currency: 'IDR',
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'Standard breakfast allowance'
            },
            {
                id: 2,
                location: 'jakarta',
                locationName: 'Jakarta',
                mealType: 'lunch',
                mealTypeName: 'Lunch',
                employeeLevel: 'staff',
                employeeLevelName: 'Staff',
                amount: 75000,
                currency: 'IDR',
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'Standard lunch allowance'
            },
            {
                id: 3,
                location: 'singapore',
                locationName: 'Singapore',
                mealType: 'dinner',
                mealTypeName: 'Dinner',
                employeeLevel: 'manager',
                employeeLevelName: 'Manager',
                amount: 50,
                currency: 'SGD',
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'Manager dinner allowance for Singapore'
            }
        ];

        function renderMealCapsTable() {
            const tbody = document.getElementById('mealCapsTableBody');
            const filteredCaps = getFilteredMealCaps();
            
            tbody.innerHTML = filteredCaps.map(cap => `
                <tr>
                    <td>${cap.locationName}</td>
                    <td>
                        <i class="fas fa-${getMealIcon(cap.mealType)} me-2"></i>
                        ${cap.mealTypeName}
                    </td>
                    <td>
                        <span class="badge bg-${getLevelBadgeColor(cap.employeeLevel)}">
                            ${cap.employeeLevelName}
                        </span>
                    </td>
                    <td>${formatCurrency(cap.amount, cap.currency)}</td>
                    <td>${cap.currency}</td>
                    <td>${formatDate(cap.effectiveDate)}</td>
                    <td>
                        <span class="badge bg-${cap.status === 'active' ? 'success' : 'secondary'}">
                            ${cap.status.charAt(0).toUpperCase() + cap.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="editMealCap(${cap.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteMealCap(${cap.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getFilteredMealCaps() {
            const locationFilter = document.getElementById('filterLocation').value;
            const mealTypeFilter = document.getElementById('filterMealType').value;
            const employeeLevelFilter = document.getElementById('filterEmployeeLevel').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            return mealCaps.filter(cap => {
                const matchesLocation = !locationFilter || cap.location === locationFilter;
                const matchesMealType = !mealTypeFilter || cap.mealType === mealTypeFilter;
                const matchesEmployeeLevel = !employeeLevelFilter || cap.employeeLevel === employeeLevelFilter;
                const matchesStatus = !statusFilter || cap.status === statusFilter;
                const matchesSearch = !searchTerm || 
                    cap.locationName.toLowerCase().includes(searchTerm) ||
                    cap.mealTypeName.toLowerCase().includes(searchTerm) ||
                    cap.employeeLevelName.toLowerCase().includes(searchTerm);
                
                return matchesLocation && matchesMealType && matchesEmployeeLevel && matchesStatus && matchesSearch;
            });
        }

        function getMealIcon(mealType) {
            const icons = {
                'breakfast': 'coffee',
                'lunch': 'utensils',
                'dinner': 'wine-glass-alt',
                'snack': 'cookie-bite'
            };
            return icons[mealType] || 'utensils';
        }

        function getLevelBadgeColor(level) {
            const colors = {
                'staff': 'secondary',
                'supervisor': 'info',
                'manager': 'warning',
                'director': 'danger'
            };
            return colors[level] || 'secondary';
        }

        function formatCurrency(amount, currency) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID');
        }

        function editMealCap(id) {
            const cap = mealCaps.find(c => c.id === id);
            if (cap) {
                document.getElementById('mealCapId').value = cap.id;
                document.getElementById('mealCapLocation').value = cap.location;
                document.getElementById('mealCapMealType').value = cap.mealType;
                document.getElementById('mealCapEmployeeLevel').value = cap.employeeLevel;
                document.getElementById('mealCapAmount').value = cap.amount;
                document.getElementById('mealCapCurrency').value = cap.currency;
                document.getElementById('mealCapEffectiveDate').value = cap.effectiveDate;
                document.getElementById('mealCapStatus').value = cap.status;
                document.getElementById('mealCapNotes').value = cap.notes || '';
                
                document.getElementById('mealCapModalTitle').textContent = 'Edit Meal Cap';
                new bootstrap.Modal(document.getElementById('mealCapModal')).show();
            }
        }

        function deleteMealCap(id) {
            if (confirm('Are you sure you want to delete this meal cap?')) {
                mealCaps = mealCaps.filter(c => c.id !== id);
                renderMealCapsTable();
            }
        }

        function saveMealCap() {
            const form = document.getElementById('mealCapForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const id = document.getElementById('mealCapId').value;
            const location = document.getElementById('mealCapLocation').value;
            const locationName = document.getElementById('mealCapLocation').selectedOptions[0].text;
            const mealType = document.getElementById('mealCapMealType').value;
            const mealTypeName = document.getElementById('mealCapMealType').selectedOptions[0].text;
            const employeeLevel = document.getElementById('mealCapEmployeeLevel').value;
            const employeeLevelName = document.getElementById('mealCapEmployeeLevel').selectedOptions[0].text;
            const amount = parseInt(document.getElementById('mealCapAmount').value);
            const currency = document.getElementById('mealCapCurrency').value;
            const effectiveDate = document.getElementById('mealCapEffectiveDate').value;
            const status = document.getElementById('mealCapStatus').value;
            const notes = document.getElementById('mealCapNotes').value;

            if (id) {
                // Edit existing
                const index = mealCaps.findIndex(c => c.id === parseInt(id));
                if (index !== -1) {
                    mealCaps[index] = {
                        ...mealCaps[index],
                        location, locationName, mealType, mealTypeName,
                        employeeLevel, employeeLevelName, amount, currency,
                        effectiveDate, status, notes
                    };
                }
            } else {
                // Add new
                const newId = Math.max(...mealCaps.map(c => c.id)) + 1;
                mealCaps.push({
                    id: newId,
                    location, locationName, mealType, mealTypeName,
                    employeeLevel, employeeLevelName, amount, currency,
                    effectiveDate, status, notes
                });
            }

            bootstrap.Modal.getInstance(document.getElementById('mealCapModal')).hide();
            form.reset();
            document.getElementById('mealCapId').value = '';
            document.getElementById('mealCapModalTitle').textContent = 'Add Meal Cap';
            renderMealCapsTable();
        }

        // Event listeners
        document.getElementById('filterLocation').addEventListener('change', renderMealCapsTable);
        document.getElementById('filterMealType').addEventListener('change', renderMealCapsTable);
        document.getElementById('filterEmployeeLevel').addEventListener('change', renderMealCapsTable);
        document.getElementById('filterStatus').addEventListener('change', renderMealCapsTable);
        document.getElementById('searchInput').addEventListener('input', renderMealCapsTable);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderMealCapsTable();
            
            // Set default effective date to today
            document.getElementById('mealCapEffectiveDate').value = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>
