<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mileage Rate Configuration - TrevID</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <img 
                    class="brand-logo" 
                    src="assets/brand/trevid_logo.png" 
                    srcset="/assets/brand/trevid_logo.png 1x, /assets/brand/trevid_logo@2x.png 2x" 
                    alt="TrevID â€“ Business Companion" 
                    width="140" height="36" />
            </div>
            <div class="user-info">
                <span>Hello, Admin User</span>
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </header>

    <div class="container-fluid mt-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="admin-breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="admin.html">Admin</a></li>
                <li class="breadcrumb-item"><a href="admin.html">Policies</a></li>
                <li class="breadcrumb-item active" aria-current="page">Mileage Rate</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="admin-page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-road"></i>Mileage Rate Configuration</h1>
                    <p>Configure mileage reimbursement rates by vehicle type and region</p>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#mileageRateModal">
                    <i class="fas fa-plus me-2"></i>Add Mileage Rate
                </button>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="card admin-filter-card">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Vehicle Type</label>
                        <select class="form-select" id="filterVehicleType">
                            <option value="">All Vehicle Types</option>
                            <option value="motorcycle">Motorcycle</option>
                            <option value="car">Car</option>
                            <option value="suv">SUV</option>
                            <option value="truck">Truck</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Region</label>
                        <select class="form-select" id="filterRegion">
                            <option value="">All Regions</option>
                            <option value="jakarta">Jakarta</option>
                            <option value="java">Java</option>
                            <option value="sumatra">Sumatra</option>
                            <option value="kalimantan">Kalimantan</option>
                            <option value="sulawesi">Sulawesi</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="filterStatus">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Search</label>
                        <input type="text" class="form-control" id="searchInput" placeholder="Search vehicle type or region...">
                    </div>
                </div>
            </div>
        </div>

        <!-- Mileage Rates Table -->
        <div class="card admin-table-card">
            <div class="card-header">
                <h5 class="card-title mb-0">Mileage Rates</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="mileageRatesTable">
                        <thead>
                            <tr>
                                <th>Vehicle Type</th>
                                <th>Region</th>
                                <th>Rate (IDR/km)</th>
                                <th>Engine Size</th>
                                <th>Effective Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="mileageRatesTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Mileage Rate Modal -->
    <div class="modal fade" id="mileageRateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mileageRateModalTitle">Add Mileage Rate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="mileageRateForm">
                        <input type="hidden" id="mileageRateId">
                        <div class="mb-3">
                            <label class="form-label">Vehicle Type *</label>
                            <select class="form-select" id="mileageRateVehicleType" required>
                                <option value="">Select Vehicle Type</option>
                                <option value="motorcycle">Motorcycle</option>
                                <option value="car">Car</option>
                                <option value="suv">SUV</option>
                                <option value="truck">Truck</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Region *</label>
                            <select class="form-select" id="mileageRateRegion" required>
                                <option value="">Select Region</option>
                                <option value="jakarta">Jakarta</option>
                                <option value="java">Java</option>
                                <option value="sumatra">Sumatra</option>
                                <option value="kalimantan">Kalimantan</option>
                                <option value="sulawesi">Sulawesi</option>
                                <option value="papua">Papua</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Rate per KM (IDR) *</label>
                            <input type="number" class="form-control" id="mileageRateAmount" required min="0" step="50">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Engine Size</label>
                            <select class="form-select" id="mileageRateEngineSize">
                                <option value="">Not Applicable</option>
                                <option value="<1000cc">< 1000cc</option>
                                <option value="1000-1500cc">1000-1500cc</option>
                                <option value="1500-2000cc">1500-2000cc</option>
                                <option value=">2000cc">> 2000cc</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Effective Date *</label>
                            <input type="date" class="form-control" id="mileageRateEffectiveDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="mileageRateStatus">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="mileageRateNotes" rows="3" placeholder="Additional notes or conditions..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveMileageRate()">Save Mileage Rate</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample mileage rates data
        let mileageRates = [
            {
                id: 1,
                vehicleType: 'motorcycle',
                vehicleTypeName: 'Motorcycle',
                region: 'jakarta',
                regionName: 'Jakarta',
                rate: 1500,
                engineSize: '<1000cc',
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'Standard motorcycle rate for Jakarta'
            },
            {
                id: 2,
                vehicleType: 'car',
                vehicleTypeName: 'Car',
                region: 'jakarta',
                regionName: 'Jakarta',
                rate: 3000,
                engineSize: '1000-1500cc',
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'Standard car rate for Jakarta'
            },
            {
                id: 3,
                vehicleType: 'suv',
                vehicleTypeName: 'SUV',
                region: 'java',
                regionName: 'Java',
                rate: 3500,
                engineSize: '1500-2000cc',
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'SUV rate for Java region'
            }
        ];

        function renderMileageRatesTable() {
            const tbody = document.getElementById('mileageRatesTableBody');
            const filteredRates = getFilteredMileageRates();
            
            tbody.innerHTML = filteredRates.map(rate => `
                <tr>
                    <td>
                        <i class="fas fa-${getVehicleIcon(rate.vehicleType)} me-2"></i>
                        ${rate.vehicleTypeName}
                    </td>
                    <td>${rate.regionName}</td>
                    <td>${formatCurrency(rate.rate)}</td>
                    <td>${rate.engineSize || '-'}</td>
                    <td>${formatDate(rate.effectiveDate)}</td>
                    <td>
                        <span class="badge bg-${rate.status === 'active' ? 'success' : 'secondary'}">
                            ${rate.status.charAt(0).toUpperCase() + rate.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="editMileageRate(${rate.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteMileageRate(${rate.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getFilteredMileageRates() {
            const vehicleTypeFilter = document.getElementById('filterVehicleType').value;
            const regionFilter = document.getElementById('filterRegion').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            return mileageRates.filter(rate => {
                const matchesVehicleType = !vehicleTypeFilter || rate.vehicleType === vehicleTypeFilter;
                const matchesRegion = !regionFilter || rate.region === regionFilter;
                const matchesStatus = !statusFilter || rate.status === statusFilter;
                const matchesSearch = !searchTerm || 
                    rate.vehicleTypeName.toLowerCase().includes(searchTerm) ||
                    rate.regionName.toLowerCase().includes(searchTerm);
                
                return matchesVehicleType && matchesRegion && matchesStatus && matchesSearch;
            });
        }

        function getVehicleIcon(vehicleType) {
            const icons = {
                'motorcycle': 'motorcycle',
                'car': 'car',
                'suv': 'car-side',
                'truck': 'truck'
            };
            return icons[vehicleType] || 'car';
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID');
        }

        function editMileageRate(id) {
            const rate = mileageRates.find(r => r.id === id);
            if (rate) {
                document.getElementById('mileageRateId').value = rate.id;
                document.getElementById('mileageRateVehicleType').value = rate.vehicleType;
                document.getElementById('mileageRateRegion').value = rate.region;
                document.getElementById('mileageRateAmount').value = rate.rate;
                document.getElementById('mileageRateEngineSize').value = rate.engineSize || '';
                document.getElementById('mileageRateEffectiveDate').value = rate.effectiveDate;
                document.getElementById('mileageRateStatus').value = rate.status;
                document.getElementById('mileageRateNotes').value = rate.notes || '';
                
                document.getElementById('mileageRateModalTitle').textContent = 'Edit Mileage Rate';
                new bootstrap.Modal(document.getElementById('mileageRateModal')).show();
            }
        }

        function deleteMileageRate(id) {
            if (confirm('Are you sure you want to delete this mileage rate?')) {
                mileageRates = mileageRates.filter(r => r.id !== id);
                renderMileageRatesTable();
            }
        }

        function saveMileageRate() {
            const form = document.getElementById('mileageRateForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const id = document.getElementById('mileageRateId').value;
            const vehicleType = document.getElementById('mileageRateVehicleType').value;
            const vehicleTypeName = document.getElementById('mileageRateVehicleType').selectedOptions[0].text;
            const region = document.getElementById('mileageRateRegion').value;
            const regionName = document.getElementById('mileageRateRegion').selectedOptions[0].text;
            const rate = parseInt(document.getElementById('mileageRateAmount').value);
            const engineSize = document.getElementById('mileageRateEngineSize').value;
            const effectiveDate = document.getElementById('mileageRateEffectiveDate').value;
            const status = document.getElementById('mileageRateStatus').value;
            const notes = document.getElementById('mileageRateNotes').value;

            if (id) {
                // Edit existing
                const index = mileageRates.findIndex(r => r.id === parseInt(id));
                if (index !== -1) {
                    mileageRates[index] = {
                        ...mileageRates[index],
                        vehicleType, vehicleTypeName, region, regionName,
                        rate, engineSize, effectiveDate, status, notes
                    };
                }
            } else {
                // Add new
                const newId = Math.max(...mileageRates.map(r => r.id)) + 1;
                mileageRates.push({
                    id: newId,
                    vehicleType, vehicleTypeName, region, regionName,
                    rate, engineSize, effectiveDate, status, notes
                });
            }

            bootstrap.Modal.getInstance(document.getElementById('mileageRateModal')).hide();
            form.reset();
            document.getElementById('mileageRateId').value = '';
            document.getElementById('mileageRateModalTitle').textContent = 'Add Mileage Rate';
            renderMileageRatesTable();
        }

        // Event listeners
        document.getElementById('filterVehicleType').addEventListener('change', renderMileageRatesTable);
        document.getElementById('filterRegion').addEventListener('change', renderMileageRatesTable);
        document.getElementById('filterStatus').addEventListener('change', renderMileageRatesTable);
        document.getElementById('searchInput').addEventListener('input', renderMileageRatesTable);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderMileageRatesTable();
            
            // Set default effective date to today
            document.getElementById('mileageRateEffectiveDate').value = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>
