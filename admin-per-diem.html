<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Per Diem Configuration - TrevID</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <img 
                    class="brand-logo" 
                    src="/assets/brand/trevid_logo.png" 
                    srcset="/assets/brand/trevid_logo.png 1x, /assets/brand/trevid_logo@2x.png 2x" 
                    alt="TrevID â€“ Business Companion" 
                    width="140" height="36" />
            </div>
            <div class="user-info">
                <span>Hello, Admin User</span>
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </header>

    <div class="container-fluid mt-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="admin-breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="admin.html">Admin</a></li>
                <li class="breadcrumb-item"><a href="admin.html">Policies</a></li>
                <li class="breadcrumb-item active" aria-current="page">Per Diem</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="admin-page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-calendar-day"></i>Per Diem Configuration</h1>
                    <p>Configure daily allowances by location and employee level</p>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#perDiemModal">
                    <i class="fas fa-plus me-2"></i>Add Per Diem Rate
                </button>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="card admin-filter-card">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Location</label>
                        <select class="form-select" id="filterLocation">
                            <option value="">All Locations</option>
                            <option value="jakarta">Jakarta</option>
                            <option value="surabaya">Surabaya</option>
                            <option value="bandung">Bandung</option>
                            <option value="bali">Bali</option>
                            <option value="singapore">Singapore</option>
                            <option value="kuala-lumpur">Kuala Lumpur</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Employee Level</label>
                        <select class="form-select" id="filterEmployeeLevel">
                            <option value="">All Levels</option>
                            <option value="staff">Staff</option>
                            <option value="supervisor">Supervisor</option>
                            <option value="manager">Manager</option>
                            <option value="director">Director</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="filterStatus">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Search</label>
                        <input type="text" class="form-control" id="searchInput" placeholder="Search location or level...">
                    </div>
                </div>
            </div>
        </div>

        <!-- Per Diem Rates Table -->
        <div class="card admin-table-card">
            <div class="card-header">
                <h5 class="card-title mb-0">Per Diem Rates</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="perDiemTable">
                        <thead>
                            <tr>
                                <th>Location</th>
                                <th>Employee Level</th>
                                <th>Daily Rate</th>
                                <th>Currency</th>
                                <th>Includes</th>
                                <th>Effective Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="perDiemTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Per Diem Modal -->
    <div class="modal fade" id="perDiemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="perDiemModalTitle">Add Per Diem Rate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="perDiemForm">
                        <input type="hidden" id="perDiemId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Location *</label>
                                    <select class="form-select" id="perDiemLocation" required>
                                        <option value="">Select Location</option>
                                        <option value="jakarta">Jakarta</option>
                                        <option value="surabaya">Surabaya</option>
                                        <option value="bandung">Bandung</option>
                                        <option value="bali">Bali</option>
                                        <option value="singapore">Singapore</option>
                                        <option value="kuala-lumpur">Kuala Lumpur</option>
                                        <option value="bangkok">Bangkok</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Employee Level *</label>
                                    <select class="form-select" id="perDiemEmployeeLevel" required>
                                        <option value="">Select Employee Level</option>
                                        <option value="staff">Staff</option>
                                        <option value="supervisor">Supervisor</option>
                                        <option value="manager">Manager</option>
                                        <option value="director">Director</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Daily Rate *</label>
                                    <input type="number" class="form-control" id="perDiemRate" required min="0" step="1000">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Currency *</label>
                                    <select class="form-select" id="perDiemCurrency" required>
                                        <option value="IDR">IDR - Indonesian Rupiah</option>
                                        <option value="USD">USD - US Dollar</option>
                                        <option value="SGD">SGD - Singapore Dollar</option>
                                        <option value="MYR">MYR - Malaysian Ringgit</option>
                                        <option value="THB">THB - Thai Baht</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Includes</label>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="includesMeals">
                                        <label class="form-check-label" for="includesMeals">
                                            Meals
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="includesTransport">
                                        <label class="form-check-label" for="includesTransport">
                                            Local Transport
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="includesIncidentals">
                                        <label class="form-check-label" for="includesIncidentals">
                                            Incidentals
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="includesLaundry">
                                        <label class="form-check-label" for="includesLaundry">
                                            Laundry
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Effective Date *</label>
                                    <input type="date" class="form-control" id="perDiemEffectiveDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="perDiemStatus">
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="perDiemNotes" rows="3" placeholder="Additional notes or conditions..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="savePerDiem()">Save Per Diem Rate</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample per diem data
        let perDiemRates = [
            {
                id: 1,
                location: 'jakarta',
                locationName: 'Jakarta',
                employeeLevel: 'staff',
                employeeLevelName: 'Staff',
                rate: 300000,
                currency: 'IDR',
                includes: ['meals', 'transport', 'incidentals'],
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'Standard per diem for Jakarta business travel'
            },
            {
                id: 2,
                location: 'singapore',
                locationName: 'Singapore',
                employeeLevel: 'manager',
                employeeLevelName: 'Manager',
                rate: 150,
                currency: 'SGD',
                includes: ['meals', 'transport', 'incidentals', 'laundry'],
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'Manager per diem for Singapore including laundry'
            },
            {
                id: 3,
                location: 'bali',
                locationName: 'Bali',
                employeeLevel: 'director',
                employeeLevelName: 'Director',
                rate: 500000,
                currency: 'IDR',
                includes: ['meals', 'transport', 'incidentals', 'laundry'],
                effectiveDate: '2024-01-01',
                status: 'active',
                notes: 'Executive per diem for Bali'
            }
        ];

        function renderPerDiemTable() {
            const tbody = document.getElementById('perDiemTableBody');
            const filteredRates = getFilteredPerDiemRates();
            
            tbody.innerHTML = filteredRates.map(rate => `
                <tr>
                    <td>
                        <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                        ${rate.locationName}
                    </td>
                    <td>
                        <span class="badge bg-${getLevelBadgeColor(rate.employeeLevel)}">
                            ${rate.employeeLevelName}
                        </span>
                    </td>
                    <td>${formatCurrency(rate.rate, rate.currency)}</td>
                    <td>${rate.currency}</td>
                    <td>
                        <div class="d-flex flex-wrap gap-1">
                            ${rate.includes.map(item => `
                                <span class="badge bg-light text-dark">
                                    <i class="fas fa-${getIncludeIcon(item)} me-1"></i>
                                    ${item.charAt(0).toUpperCase() + item.slice(1)}
                                </span>
                            `).join('')}
                        </div>
                    </td>
                    <td>${formatDate(rate.effectiveDate)}</td>
                    <td>
                        <span class="badge bg-${rate.status === 'active' ? 'success' : 'secondary'}">
                            ${rate.status.charAt(0).toUpperCase() + rate.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="editPerDiem(${rate.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deletePerDiem(${rate.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getFilteredPerDiemRates() {
            const locationFilter = document.getElementById('filterLocation').value;
            const employeeLevelFilter = document.getElementById('filterEmployeeLevel').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            return perDiemRates.filter(rate => {
                const matchesLocation = !locationFilter || rate.location === locationFilter;
                const matchesEmployeeLevel = !employeeLevelFilter || rate.employeeLevel === employeeLevelFilter;
                const matchesStatus = !statusFilter || rate.status === statusFilter;
                const matchesSearch = !searchTerm || 
                    rate.locationName.toLowerCase().includes(searchTerm) ||
                    rate.employeeLevelName.toLowerCase().includes(searchTerm);
                
                return matchesLocation && matchesEmployeeLevel && matchesStatus && matchesSearch;
            });
        }

        function getLevelBadgeColor(level) {
            const colors = {
                'staff': 'secondary',
                'supervisor': 'info',
                'manager': 'warning',
                'director': 'danger'
            };
            return colors[level] || 'secondary';
        }

        function getIncludeIcon(item) {
            const icons = {
                'meals': 'utensils',
                'transport': 'car',
                'incidentals': 'shopping-bag',
                'laundry': 'tshirt'
            };
            return icons[item] || 'check';
        }

        function formatCurrency(amount, currency) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID');
        }

        function editPerDiem(id) {
            const rate = perDiemRates.find(r => r.id === id);
            if (rate) {
                document.getElementById('perDiemId').value = rate.id;
                document.getElementById('perDiemLocation').value = rate.location;
                document.getElementById('perDiemEmployeeLevel').value = rate.employeeLevel;
                document.getElementById('perDiemRate').value = rate.rate;
                document.getElementById('perDiemCurrency').value = rate.currency;
                document.getElementById('perDiemEffectiveDate').value = rate.effectiveDate;
                document.getElementById('perDiemStatus').value = rate.status;
                document.getElementById('perDiemNotes').value = rate.notes || '';
                
                // Set checkboxes
                document.getElementById('includesMeals').checked = rate.includes.includes('meals');
                document.getElementById('includesTransport').checked = rate.includes.includes('transport');
                document.getElementById('includesIncidentals').checked = rate.includes.includes('incidentals');
                document.getElementById('includesLaundry').checked = rate.includes.includes('laundry');
                
                document.getElementById('perDiemModalTitle').textContent = 'Edit Per Diem Rate';
                new bootstrap.Modal(document.getElementById('perDiemModal')).show();
            }
        }

        function deletePerDiem(id) {
            if (confirm('Are you sure you want to delete this per diem rate?')) {
                perDiemRates = perDiemRates.filter(r => r.id !== id);
                renderPerDiemTable();
            }
        }

        function savePerDiem() {
            const form = document.getElementById('perDiemForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const id = document.getElementById('perDiemId').value;
            const location = document.getElementById('perDiemLocation').value;
            const locationName = document.getElementById('perDiemLocation').selectedOptions[0].text;
            const employeeLevel = document.getElementById('perDiemEmployeeLevel').value;
            const employeeLevelName = document.getElementById('perDiemEmployeeLevel').selectedOptions[0].text;
            const rate = parseInt(document.getElementById('perDiemRate').value);
            const currency = document.getElementById('perDiemCurrency').value;
            const effectiveDate = document.getElementById('perDiemEffectiveDate').value;
            const status = document.getElementById('perDiemStatus').value;
            const notes = document.getElementById('perDiemNotes').value;
            
            // Get includes
            const includes = [];
            if (document.getElementById('includesMeals').checked) includes.push('meals');
            if (document.getElementById('includesTransport').checked) includes.push('transport');
            if (document.getElementById('includesIncidentals').checked) includes.push('incidentals');
            if (document.getElementById('includesLaundry').checked) includes.push('laundry');

            if (id) {
                // Edit existing
                const index = perDiemRates.findIndex(r => r.id === parseInt(id));
                if (index !== -1) {
                    perDiemRates[index] = {
                        ...perDiemRates[index],
                        location, locationName, employeeLevel, employeeLevelName,
                        rate, currency, includes, effectiveDate, status, notes
                    };
                }
            } else {
                // Add new
                const newId = Math.max(...perDiemRates.map(r => r.id)) + 1;
                perDiemRates.push({
                    id: newId,
                    location, locationName, employeeLevel, employeeLevelName,
                    rate, currency, includes, effectiveDate, status, notes
                });
            }

            bootstrap.Modal.getInstance(document.getElementById('perDiemModal')).hide();
            form.reset();
            document.getElementById('perDiemId').value = '';
            document.getElementById('perDiemModalTitle').textContent = 'Add Per Diem Rate';
            renderPerDiemTable();
        }

        // Event listeners
        document.getElementById('filterLocation').addEventListener('change', renderPerDiemTable);
        document.getElementById('filterEmployeeLevel').addEventListener('change', renderPerDiemTable);
        document.getElementById('filterStatus').addEventListener('change', renderPerDiemTable);
        document.getElementById('searchInput').addEventListener('input', renderPerDiemTable);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderPerDiemTable();
            
            // Set default effective date to today
            document.getElementById('perDiemEffectiveDate').value = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>