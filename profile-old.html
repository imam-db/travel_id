<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Travel Expense Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="icon-192.svg">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-plane"></i>
                <span>TravelExpense</span>
            </div>
            <div class="user-info">
                <span>Hello, John Doe</span>
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="travel.html" class="nav-item">
            <i class="fas fa-plane"></i>
            <span>Travel</span>
        </a>
        <a href="vehicle.html" class="nav-item">
            <i class="fas fa-car"></i>
            <span>Vehicle</span>
        </a>
        <a href="expenses.html" class="nav-item">
            <i class="fas fa-receipt"></i>
            <span>Expenses</span>
        </a>
        <a href="approvals.html" class="nav-item">
            <i class="fas fa-check-circle"></i>
            <span>Approvals</span>
        </a>
        <a href="profile.html" class="nav-item active" aria-current="page">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Sticky Sub Navigation -->
            <nav class="subnav">
                <a href="#personal" class="active" aria-current="page">Personal</a>
                <a href="#business">Business</a>
                <a href="#preferences">Preferences</a>
                <a href="#reimb">Reimbursements</a>
                <a href="#budget">Budget</a>
                <a href="#policy">Policies</a>
                <a href="#mwp">MWP</a>
                <a href="#vehicle">Vehicle</a>
                <div class="subnav-more">
                    <button class="more-btn" onclick="toggleMoreMenu()" aria-expanded="false">
                        More <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="more-dropdown">
                        <a href="#integrations">Integrations</a>
                        <a href="#notifications">Notifications</a>
                        <a href="#delegation">Delegation</a>
                        <a href="#sessions">Sessions</a>
                        <a href="#security">Security</a>
                        <a href="#app">App</a>
                    </div>
                </div>
            </nav>
            
            <div class="subnav-dropdown" style="display: none;">
                <select class="subnav-select" onchange="location.hash = this.value">
                    <option value="#personal">Personal</option>
                    <option value="#business">Business</option>
                    <option value="#preferences">Preferences</option>
                    <option value="#reimb">Reimbursements</option>
                    <option value="#budget">Budget</option>
                    <option value="#policy">Policies</option>
                    <option value="#mwp">MWP</option>
                    <option value="#vehicle">Vehicle</option>
                    <option value="#integrations">Integrations</option>
                    <option value="#notifications">Notifications</option>
                    <option value="#delegation">Delegation</option>
                    <option value="#sessions">Sessions</option>
                    <option value="#security">Security</option>
                    <option value="#app">App</option>
                </select>
            </div>
            <!-- Profile Header -->
            <section class="profile-header">
                <div class="profile-avatar">
                    <img src="https://via.placeholder.com/120x120" alt="John Doe avatar" id="profileImage" loading="lazy">
                    <button class="change-photo-btn" onclick="changePhoto()">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                <div class="profile-info">
                    <h1>John Doe</h1>
                    <p class="job-title">Senior Marketing Manager</p>
                    <p class="department">Marketing Department</p>
                    <p class="employee-id">ID: EMP-2024-001</p>
                </div>
            </section>

            <!-- Profile Stats -->
            <section class="profile-stats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-plane"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">24</span>
                            <span class="stat-label">Total Trips</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">48</span>
                            <span class="stat-label">Expense Reports</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">$125K</span>
                            <span class="stat-label">Total Expenses</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number">96%</span>
                            <span class="stat-label">Approval Rate</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Sections -->
            <section class="profile-sections">
                <!-- Personal Information Section -->
                <div id="personal" class="profile-section">
                    <div class="section-header">
                        <h2><i class="fas fa-user"></i> Personal Information</h2>
                        <p class="section-desc">Information you can edit and manage yourself</p>
                    </div>
                    
                    <div class="profile-grid">
                        <!-- Basic Identity Card -->
                        <div class="profile-card">
                            <div class="card-header">
                                <h3><i class="fas fa-id-card"></i> Basic Identity</h3>
                                <button class="edit-btn" onclick="editCard('basic-identity')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                            <div class="card-content" id="basic-identity">
                                <div class="info-grid">
                                    <div class="info-item editable">
                                        <label>Full Name</label>
                                        <span class="editable-field" data-field="fullName">John Doe</span>
                                    </div>
                                    <div class="info-item editable">
                                        <label>Date of Birth</label>
                                        <span class="editable-field" data-field="dateOfBirth">12 Mar 1985</span>
                                    </div>
                                    <div class="info-item editable">
                                        <label>National ID (KTP)</label>
                                        <span class="editable-field" data-field="nationalId">3174************</span>
                                    </div>
                                    <div class="info-item editable">
                                        <label>Passport No</label>
                                        <span class="editable-field" data-field="passportNo">C123456</span>
                                    </div>
                                    <div class="info-item editable full-width">
                                        <label>Home Address</label>
                                        <span class="editable-field" data-field="homeAddress">Jl. Mawar No 8, Surabaya</span>
                                    </div>
                                </div>
                                <div class="card-actions" style="display: none;">
                                    <button class="save-btn" onclick="saveCard('basic-identity')">Save</button>
                                    <button class="cancel-btn" onclick="cancelEdit('basic-identity')">Cancel</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact Information Card -->
                        <div class="profile-card">
                            <div class="card-header">
                                <h3><i class="fas fa-phone"></i> Contact Information</h3>
                                <button class="edit-btn" onclick="editCard('contact-info')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                            <div class="card-content" id="contact-info">
                                <div class="info-grid">
                                    <div class="info-item editable">
                                        <label>Mobile No</label>
                                        <a href="tel:+6281234567890" class="phone-link editable-field" data-field="mobileNo">+62 812 34 5678 90</a>
                                    </div>
                                    <div class="info-item editable">
                                        <label>Personal Email</label>
                                        <span class="editable-field" data-field="personalEmail">john.personal@gmail.com</span>
                                    </div>
                                    <div class="info-item emergency-contact">
                                        <label><i class="fas fa-exclamation-triangle"></i> Emergency Contact 1</label>
                                        <div class="contact-details">
                                            <strong class="editable-field" data-field="emergency1Name">Sarah Doe</strong>
                                            <span class="relation editable-field" data-field="emergency1Relation">Wife</span>
                                            <a href="tel:+6281234567891" class="phone-link editable-field" data-field="emergency1Phone">+62 812 34 5678 91</a>
                                        </div>
                                    </div>
                                    <div class="info-item emergency-contact">
                                        <label><i class="fas fa-exclamation-triangle"></i> Emergency Contact 2</label>
                                        <div class="contact-details">
                                            <strong class="editable-field" data-field="emergency2Name">Tom Doe</strong>
                                            <span class="relation editable-field" data-field="emergency2Relation">Brother</span>
                                            <a href="tel:+6281234567892" class="phone-link editable-field" data-field="emergency2Phone">+62 812 34 5678 92</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-actions" style="display: none;">
                                    <button class="save-btn" onclick="saveCard('contact-info')">Save</button>
                                    <button class="cancel-btn" onclick="cancelEdit('contact-info')">Cancel</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Document Upload Card -->
                        <div class="profile-card">
                            <div class="card-header">
                                <h3><i class="fas fa-file-upload"></i> Identity Documents</h3>
                                <button class="edit-btn" onclick="editCard('documents')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                            <div class="card-content" id="documents">
                                <div class="document-grid">
                                    <div class="document-item">
                                        <label>KTP (National ID)</label>
                                        <div class="document-upload">
                                            <div class="document-preview">
                                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA4MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yNCAyMEgzNlYyNEgyNFYyMFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHA+dGggZD0iTTI0IDI2SDU2VjMwSDI0VjI2WiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMjQgMzJINTZWMzZIMjRWMzJaIiBmaWxsPSIjOUNBM0FGIi8+CjwvcGF0aD4KPC9zdmc+" alt="KTP Preview" class="doc-thumbnail">
                                            </div>
                                            <div class="document-status">
                                                <span class="badge uploaded"><i class="fas fa-check"></i> Uploaded</span>
                                                <button class="upload-btn" onclick="uploadDocument('ktp')">Replace</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="document-item">
                                        <label>Passport</label>
                                        <div class="document-upload">
                                            <div class="document-preview">
                                                <div class="doc-placeholder">
                                                    <i class="fas fa-file-upload"></i>
                                                    <span>No file uploaded</span>
                                                </div>
                                            </div>
                                            <div class="document-status">
                                                <span class="badge missing"><i class="fas fa-exclamation"></i> Missing</span>
                                                <button class="upload-btn" onclick="uploadDocument('passport')">Upload</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Travel Preferences -->
                <div class="profile-card" id="preferences">
                    <div class="card-header">
                        <h3><i class="fas fa-plane"></i> Travel Preferences</h3>
                        <button class="edit-btn" onclick="editTravelPrefs()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="preferences-section">
                            <h4>Booking Preferences</h4>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Preferred Airline</label>
                                    <span>Garuda Indonesia</span>
                                </div>
                                <div class="info-item">
                                    <label>Seat Preference</label>
                                    <span>Aisle Seat</span>
                                </div>
                                <div class="info-item">
                                    <label>Baggage Preference</label>
                                    <span>25kg checked bag</span>
                                </div>
                                <div class="info-item">
                                    <label>Meal Preference</label>
                                    <span>Halal</span>
                                </div>
                                <div class="info-item">
                                    <label>Hotel Category</label>
                                    <span>4-5 Star Hotels</span>
                                </div>
                                <div class="info-item">
                                    <label>Room Type</label>
                                    <span>Single Room, Non-smoking</span>
                                </div>
                                <div class="info-item">
                                    <label>Car Rental</label>
                                    <span>Compact/Economy</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preferences-section">
                            <h4>Loyalty Programs</h4>
                            <div class="loyalty-list">
                                <div class="loyalty-item">
                                    <div class="loyalty-icon airline">
                                        <i class="fas fa-plane"></i>
                                    </div>
                                    <div class="loyalty-details">
                                        <span class="loyalty-name">Garuda Miles</span>
                                        <span class="loyalty-number">GM123456789</span>
                                        <span class="loyalty-tier">Gold Member</span>
                                    </div>
                                </div>
                                
                                <div class="loyalty-item">
                                    <div class="loyalty-icon hotel">
                                        <i class="fas fa-bed"></i>
                                    </div>
                                    <div class="loyalty-details">
                                        <span class="loyalty-name">Marriott Bonvoy</span>
                                        <span class="loyalty-number">MB987654321</span>
                                        <span class="loyalty-tier">Platinum Elite</span>
                                    </div>
                                </div>
                                
                                <div class="loyalty-item">
                                    <div class="loyalty-icon rental">
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="loyalty-details">
                                        <span class="loyalty-name">Hertz Gold Plus</span>
                                        <span class="loyalty-number">HZ456789123</span>
                                        <span class="loyalty-tier">Gold Member</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preferences-section">
                            <h4>Cash Advance Defaults</h4>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Default Currency</label>
                                    <span>IDR (Indonesian Rupiah)</span>
                                </div>
                                <div class="info-item">
                                    <label>Disbursement Method</label>
                                    <span>Bank Transfer</span>
                                </div>
                                <div class="info-item">
                                    <label>Default Amount</label>
                                    <span>IDR 10,000,000</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="last-updated">Last updated by John Doe on 18 Dec 2024</div>
                    </div>
                </div>

                <!-- Business Information Section -->
                <div id="business" class="profile-section">
                    <div class="section-header">
                        <h2><i class="fas fa-briefcase"></i> Business Information</h2>
                        <p class="section-desc">Information managed by HR and Finance teams</p>
                    </div>
                    
                    <div class="profile-grid">
                        <!-- Employment & Organization Card -->
                        <div class="profile-card locked-card">
                            <div class="card-header">
                                <h3><i class="fas fa-building"></i> Employment & Organization</h3>
                                <span class="admin-badge"><i class="fas fa-shield-alt"></i> Managed by Admin</span>
                            </div>
                            <div class="card-content">
                                <div class="info-grid">
                                    <div class="info-item locked">
                                        <label><i class="fas fa-lock"></i> Cost Center</label>
                                        <span>CC-MKT-001</span>
                                    </div>
                                    <div class="info-item locked">
                                        <label><i class="fas fa-lock"></i> Division / Region</label>
                                        <span>Marketing Division - Jakarta</span>
                                    </div>
                                    <div class="info-item locked">
                                        <label><i class="fas fa-lock"></i> Employee Grade</label>
                                        <span>Grade 12</span>
                                    </div>
                                    <div class="info-item locked">
                                        <label><i class="fas fa-lock"></i> Join Date</label>
                                        <span>15 January 2020</span>
                                    </div>
                                </div>
                                <button class="request-change-btn" onclick="requestChange('employment')">
                                    <i class="fas fa-envelope"></i> Request Change
                                </button>
                            </div>
                        </div>
                        
                        <!-- Advance & Approval Chain Card -->
                        <div class="profile-card locked-card">
                            <div class="card-header">
                                <h3><i class="fas fa-route"></i> Advance & Approval</h3>
                                <span class="admin-badge"><i class="fas fa-shield-alt"></i> Managed by Admin</span>
                            </div>
                            <div class="card-content">
                                <div class="info-item locked">
                                    <label><i class="fas fa-lock"></i> Advance Limit</label>
                                    <span class="amount">Rp 5,000,000 / request</span>
                                </div>
                                <div class="approval-chain">
                                    <label>Approval Chain:</label>
                                    <div class="approver-list">
                                        <div class="approver-item">
                                            <div class="approver-number">1️⃣</div>
                                            <div class="approver-info">
                                                <div class="approver-avatar">
                                                    <img src="https://via.placeholder.com/32x32" alt="Sarah Johnson">
                                                </div>
                                                <div class="approver-details">
                                                    <strong>Sarah Johnson</strong>
                                                    <span>Line Manager</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="approval-arrow">➔</div>
                                        <div class="approver-item">
                                            <div class="approver-number">2️⃣</div>
                                            <div class="approver-info">
                                                <div class="approver-avatar">
                                                    <img src="https://via.placeholder.com/32x32" alt="Michael Chen">
                                                </div>
                                                <div class="approver-details">
                                                    <strong>Michael Chen</strong>
                                                    <span>Finance</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="approval-arrow">➔</div>
                                        <div class="approver-item">
                                            <div class="approver-number">3️⃣</div>
                                            <div class="approver-info">
                                                <div class="approver-avatar">
                                                    <img src="https://via.placeholder.com/32x32" alt="Lisa Wong">
                                                </div>
                                                <div class="approver-details">
                                                    <strong>Lisa Wong</strong>
                                                    <span>HR</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="request-change-btn" onclick="requestChange('approval')">
                                    <i class="fas fa-envelope"></i> Request Change
                                </button>
                            </div>
                        </div>
                        
                        <!-- Bank & Tax Information Card -->
                        <div class="profile-card locked-card restricted-card">
                            <div class="card-header">
                                <h3><i class="fas fa-university"></i> Reimbursements</h3>
                                <span class="restricted-badge"><i class="fas fa-exclamation-triangle"></i> RESTRICTED</span>
                            </div>
                            <div class="card-content">
                                <div class="restricted-notice">
                                    <i class="fas fa-shield-alt"></i>
                                    <div>
                                        <strong>RESTRICTED - CONTACT FINANCE</strong>
                                        <p>This information is confidential and managed by the Finance team.</p>
                                    </div>
                                </div>
                                <div class="info-grid">
                                    <div class="info-item locked restricted">
                                        <label><i class="fas fa-lock"></i> Bank Account</label>
                                        <span class="masked-data" onclick="showRestrictedModal('bank')">••••••••••••1234 <i class="fas fa-eye"></i></span>
                                    </div>
                                    <div class="info-item locked restricted">
                                        <label><i class="fas fa-lock"></i> NPWP</label>
                                        <span class="masked-data" onclick="showRestrictedModal('npwp')">••.•••.•••.•-•••.••• <i class="fas fa-eye"></i></span>
                                    </div>
                                </div>
                                <button class="contact-finance-btn" onclick="contactFinance()">
                                    <i class="fas fa-envelope"></i> Contact Finance Team
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Budget Information -->
                <div id="budget" class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-wallet"></i> Budget Information</h3>
                        <span class="badge-admin"><i class="fas fa-lock"></i> Managed by Admin</span>
                    </div>
                    <div class="card-content">
                        <div class="budget-overview locked">
                            <div class="budget-item">
                                <div class="budget-header">
                                    <span class="budget-title">Monthly Travel Budget</span>
                                    <span class="budget-amount">$15,000</span>
                                </div>
                                <div class="budget-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 68%"></div>
                                    </div>
                                    <span class="progress-text">68% Used ($10,200)</span>
                                </div>
                            </div>
                            
                            <div class="budget-item">
                                <div class="budget-header">
                                    <span class="budget-title">Yearly Travel Budget</span>
                                    <span class="budget-amount">$180,000</span>
                                </div>
                                <div class="budget-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 45%"></div>
                                    </div>
                                    <span class="progress-text">45% Used ($81,000)</span>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Last updated by Finance Admin on 10 Dec 2024</div>
                    </div>
                </div>

                <!-- Bank & Tax Information -->
                <div id="reimb" class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-university"></i> Bank & Tax Information</h3>
                        <div class="badge-row">
                            <span class="badge restricted" aria-label="Restricted - Contact Finance"><i class="fas fa-lock" aria-hidden="true"></i> Restricted – Contact Finance</span>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Bank Name</label>
                                <span>Bank Central Asia (BCA)</span>
                            </div>
                            <div class="info-item">
                                <div class="badge-row">
                                    <label>Account Number</label>
                                    <span class="badge restricted" aria-label="Restricted - Contact Finance"><i class="fas fa-lock" aria-hidden="true"></i> Restricted</span>
                                </div>
                                <div class="sensitive-data">
                                    <span id="bankAccount" class="masked-data">****-****-1234</span>
                                    <button class="reveal-btn" onclick="revealSensitiveData('bankAccount', '1234-5678-1234')" disabled>
                                        <i class="fas fa-eye"></i> Contact Finance
                                    </button>
                                </div>
                                <small class="helper-text">Account number will be used for reimbursements</small>
                            </div>
                            <div class="info-item">
                                <label>Account Holder</label>
                                <span>John Doe</span>
                                <small class="helper-text">Must match your legal name on ID</small>
                            </div>
                            <div class="info-item">
                                <label>Currency</label>
                                <span>IDR (Indonesian Rupiah)</span>
                            </div>
                            <div class="info-item">
                                <div class="badge-row">
                                    <label>Tax ID (NPWP)</label>
                                    <span class="badge restricted" aria-label="Restricted - Contact Finance"><i class="fas fa-lock" aria-hidden="true"></i> Restricted</span>
                                </div>
                                <div class="sensitive-data">
                                    <span id="taxId" class="masked-data">**.***.***.*-***.***</span>
                                    <button class="reveal-btn" onclick="revealSensitiveData('taxId', '12.345.678.9-012.000')" disabled>
                                        <i class="fas fa-eye"></i> Contact Finance
                                    </button>
                                </div>
                                <small class="helper-text">Required for tax reporting compliance</small>
                            </div>
                            <div class="info-item">
                                <label>Verification Status</label>
                                <span class="status-verified"><i class="fas fa-check-circle"></i> Verified</span>
                            </div>
                        </div>
                        <div class="last-updated">Last updated by John Doe on 20 Nov 2024</div>
                    </div>
                </div>

                <!-- Policy Snapshot -->
                <div class="profile-card" id="policy">
                    <div class="card-header">
                        <h3><i class="fas fa-file-contract"></i> Policies</h3>
                        <span class="policy-badge">Grade 12 - Jakarta</span>
                    </div>
                    <div class="card-content">
                        <div class="policy-grid">
                            <div class="policy-item">
                                <div class="policy-header">
                                    <i class="fas fa-utensils"></i>
                                    <span>Per-diem Rates <i class="fas fa-info-circle tooltip-icon" title="Daily allowance for meals and incidental expenses during business travel" aria-label="Per-diem rates info"></i></span>
                                </div>
                                <div class="policy-details">
                                    <div class="policy-row">
                                        <span>Domestic</span>
                                        <span>IDR 500,000/day</span>
                                    </div>
                                    <div class="policy-row">
                                        <span>International</span>
                                        <span>$150/day</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="policy-item">
                                <div class="policy-header">
                                    <i class="fas fa-tags"></i>
                                    <span>Category Caps <i class="fas fa-info-circle tooltip-icon" title="Maximum spending limits for different expense categories" aria-label="Category caps info"></i></span>
                                </div>
                                <div class="policy-details">
                                    <div class="policy-row">
                                        <span>Accommodation</span>
                                        <span>$300/night</span>
                                    </div>
                                    <div class="policy-row">
                                        <span>Transportation</span>
                                        <span>Business Class</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="policy-item">
                                <div class="policy-header">
                                    <i class="fas fa-car"></i>
                                    <span>Mileage Policy <i class="fas fa-info-circle tooltip-icon" title="Reimbursement rates and rules for vehicle usage during business travel" aria-label="Mileage policy info"></i></span>
                                </div>
                                <div class="policy-details">
                                    <div class="policy-row">
                                        <span>Rate</span>
                                        <span>IDR 3,500/km</span>
                                    </div>
                                    <div class="policy-row">
                                        <span>Fuel Efficiency</span>
                                        <span>12 km/liter</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="policy-item">
                                <div class="policy-header">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>Budget Enforcement <i class="fas fa-info-circle tooltip-icon" title="Rules and limits that control spending within budget parameters" aria-label="Budget enforcement info"></i></span>
                                </div>
                                <div class="policy-details">
                                    <div class="policy-row">
                                        <span>Hard Limit <i class="fas fa-info-circle tooltip-icon" title="Maximum budget that cannot be exceeded without special approval" aria-label="Hard limit info"></i></span>
                                        <span class="hard-limit">$20,000/month</span>
                                    </div>
                                    <div class="policy-row">
                                        <span>Soft Warning <i class="fas fa-info-circle tooltip-icon" title="Budget threshold that triggers warnings but allows continued spending" aria-label="Soft warning info"></i></span>
                                        <span class="soft-limit">$15,000/month</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Policy effective from 1 Jan 2024</div>
                    </div>
                </div>

                <!-- Integrations -->
                <div class="profile-card" id="integrations">
                    <div class="card-header">
                        <h3><i class="fas fa-plug"></i> Integrations</h3>
                        <div class="last-updated">Last updated by IT Admin on 20 Dec 2024</div>
                    </div>
                    <div class="card-content">
                        <div class="integration-list">
                            <div class="integration-item">
                                <div class="integration-info">
                                    <div class="integration-icon traveloka">
                                        <i class="fas fa-plane"></i>
                                    </div>
                                    <div class="integration-details">
                                        <span class="integration-name">Traveloka for Business</span>
                                        <span class="integration-desc">Book flights and hotels</span>
                                    </div>
                                </div>
                                <div class="integration-status">
                                    <span class="status-chip connected">Connected (2d ago)</span>
                                    <div class="integration-actions">
                                        <button class="reconnect-btn" onclick="reconnectIntegration('traveloka')">Reconnect</button>
                                        <button class="view-logs-btn" onclick="viewIntegrationLogs('traveloka')">View Logs</button>
                                    </div>
                                    <div class="integration-meta">
                                        <small>Last sync: Bookings, Receipts • Scope: Full access</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="integration-item">
                                <div class="integration-info">
                                    <div class="integration-icon erp">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="integration-details">
                                        <span class="integration-name">ERP/Payroll System</span>
                                        <span class="integration-desc">Export expense data</span>
                                    </div>
                                </div>
                                <div class="integration-status">
                                    <span class="status-chip connected">Connected (1h ago)</span>
                                    <div class="integration-actions">
                                        <button class="reconnect-btn" onclick="reconnectIntegration('erp')">Reconnect</button>
                                        <button class="view-logs-btn" onclick="viewIntegrationLogs('erp')">View Logs</button>
                                    </div>
                                    <div class="integration-meta">
                                        <small>Last sync: Employee data, Cost centers • Scope: Read-only</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="integration-item">
                                <div class="integration-info">
                                    <div class="integration-icon slack">
                                        <i class="fab fa-slack"></i>
                                    </div>
                                    <div class="integration-details">
                                        <span class="integration-name">Slack Notifications</span>
                                        <span class="integration-desc">Receive updates in Slack</span>
                                    </div>
                                </div>
                                <div class="integration-status">
                                    <span class="status-chip error">Error</span>
                                    <div class="integration-actions">
                                        <button class="reconnect-btn" onclick="reconnectIntegration('slack')">Reconnect</button>
                                        <button class="view-logs-btn" onclick="viewIntegrationLogs('slack')">View Logs</button>
                                    </div>
                                    <div class="integration-meta">
                                        <small>Last attempt: Token expired • Scope: Notifications only</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Last sync: 5 minutes ago</div>
                    </div>
                </div>

                <!-- MWP Tools -->
                <div class="profile-card" id="mwp">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-check"></i> MWP Tools</h3>
                        <div class="last-updated">Last updated by John Doe on 18 Dec 2024</div>
                    </div>
                    <div class="card-content">
                        <div class="mwp-tools">
                            <div class="tool-section">
                                <h4>Templates</h4>
                                <div class="tool-buttons">
                                    <button class="tool-btn" onclick="downloadMWPTemplate()">
                                        <i class="fas fa-download"></i>
                                        <span>Download Template</span>
                                    </button>
                                    <button class="tool-btn" onclick="uploadMWPTemplate()">
                                        <i class="fas fa-upload"></i>
                                        <span>Upload Template</span>
                                    </button>
                                    <button class="tool-btn secondary" onclick="openValidationResults()">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Open Validation Results</span>
                                    </button>
                                </div>
                                <div class="upload-preferences">
                                    <label class="preference-item">
                                        <input type="radio" name="upload-mode" value="merge" checked>
                                        <span>Merge with existing data</span>
                                    </label>
                                    <label class="preference-item">
                                        <input type="radio" name="upload-mode" value="overwrite">
                                        <span>Overwrite existing data</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="tool-section">
                                <h4>Current Month Status</h4>
                                <div class="mwp-status">
                                    <div class="status-item">
                                        <span class="status-label">December 2024</span>
                                        <span class="status-value submitted">Submitted</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">Approval Status</span>
                                        <span class="status-value approved">Approved by Manager</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-label">Total Days</span>
                                        <span class="status-value">18 working days</span>
                                    </div>
                                </div>
                                <button class="view-mwp-btn" onclick="viewCurrentMWP()">
                                    <i class="fas fa-eye"></i>
                                    View Current MWP
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Defaults -->
                <div class="profile-card" id="vehicle">
                    <div class="card-header">
                        <h3><i class="fas fa-car"></i> Vehicle Defaults</h3>
                        <button class="edit-btn" onclick="editVehicleDefaults()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>License Plate</label>
                                <span>B 1234 XYZ</span>
                            </div>
                            <div class="info-item">
                                <label>Vehicle Type</label>
                                <span>Toyota Avanza</span>
                            </div>
                            <div class="info-item">
                                <label>Fuel Type</label>
                                <span>Pertalite</span>
                            </div>
                            <div class="info-item">
                                <label>Reimbursement Rate</label>
                                <span>IDR 3,500/km</span>
                            </div>
                            <div class="info-item">
                                <label>Fuel Efficiency</label>
                                <span>12 km/liter</span>
                            </div>
                        </div>
                        <div class="last-updated">Last updated by John Doe on 5 Dec 2024</div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="profile-card" id="notifications">
                    <div class="card-header">
                        <h3><i class="fas fa-bell"></i> Notification Settings</h3>
                    </div>
                    <div class="card-content">
                        <div class="notification-matrix">
                            <div class="matrix-header">
                                <div class="matrix-label">Notification Type</div>
                                <div class="matrix-channels">
                                    <div class="channel-header-group">
                                        <span class="channel-header">Email</span>
                                        <button class="test-notification-btn" onclick="testNotification('email')" title="Test Email"><i class="fas fa-paper-plane"></i></button>
                                    </div>
                                    <div class="channel-header-group">
                                        <span class="channel-header">Push</span>
                                        <button class="test-notification-btn" onclick="testNotification('push')" title="Test Push"><i class="fas fa-mobile-alt"></i></button>
                                    </div>
                                    <div class="channel-header-group">
                                        <span class="channel-header">Slack</span>
                                        <button class="test-notification-btn" onclick="testNotification('slack')" title="Test Slack"><i class="fab fa-slack"></i></button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">MWP Comments</span>
                                    <span class="notification-desc">New comments on MWP submissions</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">Expense Rejected</span>
                                    <span class="notification-desc">When expense reports are rejected</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">Payment Done</span>
                                    <span class="notification-desc">When payments are processed</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox">
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">Over Budget Warning</span>
                                    <span class="notification-desc">When approaching budget limits</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="matrix-row">
                                <div class="matrix-label">
                                    <span class="notification-name">Approval Required</span>
                                    <span class="notification-desc">When approvals are needed</span>
                                </div>
                                <div class="matrix-channels">
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                    <label class="toggle-switch mini">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="notification-schedule">
                            <h4>Notification Schedule</h4>
                            <div class="schedule-settings">
                                <div class="schedule-item">
                                    <div class="schedule-info">
                                        <span class="schedule-title">Quiet Hours</span>
                                        <span class="schedule-desc">No push notifications during these hours</span>
                                    </div>
                                    <div class="time-range">
                                        <select class="time-select">
                                            <option value="22">22:00</option>
                                            <option value="23">23:00</option>
                                            <option value="00" selected>00:00</option>
                                        </select>
                                        <span>to</span>
                                        <select class="time-select">
                                            <option value="06">06:00</option>
                                            <option value="07" selected>07:00</option>
                                            <option value="08">08:00</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="schedule-item">
                                    <div class="schedule-info">
                                        <span class="schedule-title">Digest Frequency</span>
                                        <span class="schedule-desc">Receive summary of notifications</span>
                                    </div>
                                    <select class="digest-select">
                                        <option value="none">No Digest</option>
                                        <option value="daily" selected>Daily Digest</option>
                                        <option value="weekly">Weekly Digest</option>
                                    </select>
                                </div>
                                
                                <div class="schedule-item">
                                    <div class="schedule-info">
                                        <span class="schedule-title">Digest Time</span>
                                        <span class="schedule-desc">When to send digest</span>
                                    </div>
                                    <select class="time-select">
                                        <option value="08" selected>08:00</option>
                                        <option value="09">09:00</option>
                                        <option value="18">18:00</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="last-updated">Last updated by John Doe on 22 Dec 2024</div>
                    </div>
                </div>

                <!-- Permissions & Audit Trail -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3><i class="fas fa-shield-alt"></i> Permissions & Audit Trail</h3>
                    </div>
                    <div class="card-content">
                        <div class="permissions-section">
                            <h4>Edit Permissions</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Personal Information</span>
                                        <span class="permission-desc">Name, email, phone, address</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge editable">You can edit</span>
                                    </div>
                                </div>
                                
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Budget Information</span>
                                        <span class="permission-desc">Budget limits, cost centers</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge managed">Managed by Admin</span>
                                    </div>
                                </div>
                                
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Approver Chain</span>
                                        <span class="permission-desc">Line manager, finance approver</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge managed">Managed by HR</span>
                                    </div>
                                </div>
                                
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Travel Preferences</span>
                                        <span class="permission-desc">Airline, hotel, car preferences</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge editable">You can edit</span>
                                    </div>
                                </div>
                                
                                <div class="permission-item">
                                    <div class="permission-info">
                                        <span class="permission-field">Bank & Tax Information</span>
                                        <span class="permission-desc">Bank account, tax ID</span>
                                    </div>
                                    <div class="permission-status">
                                        <span class="badge restricted">Restricted – Finance</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="audit-section">
                            <h4>Recent Profile Changes</h4>
                            <div class="audit-trail">
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="audit-details">
                                        <div class="audit-action">Bank account updated</div>
                                        <div class="audit-meta">by Finance Admin on 20 Dec 2024, 14:30</div>
                                    </div>
                                    <div class="audit-status">
                                        <span class="status-badge sensitive">Sensitive</span>
                                    </div>
                                </div>
                                
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="fas fa-user-edit"></i>
                                    </div>
                                    <div class="audit-details">
                                        <div class="audit-action">Travel preferences modified</div>
                                        <div class="audit-meta">by You on 18 Dec 2024, 09:15</div>
                                    </div>
                                    <div class="audit-status">
                                        <span class="status-badge normal">Normal</span>
                                    </div>
                                </div>
                                
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="audit-details">
                                        <div class="audit-action">Delegation settings changed</div>
                                        <div class="audit-meta">by You on 15 Dec 2024, 16:45</div>
                                    </div>
                                    <div class="audit-status">
                                        <span class="status-badge sensitive">Sensitive</span>
                                    </div>
                                </div>
                                
                                <div class="audit-item">
                                    <div class="audit-icon">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div class="audit-details">
                                        <div class="audit-action">2FA enabled</div>
                                        <div class="audit-meta">by You on 10 Dec 2024, 11:20</div>
                                    </div>
                                    <div class="audit-status">
                                        <span class="status-badge security">Security</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="audit-actions">
                                <button class="btn-secondary" onclick="exportAuditLog()">Export Full Audit Log</button>
                            </div>
                        </div>
                        
                        <div class="last-updated">Last updated by System on 22 Dec 2024</div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="profile-card" id="security">
                    <div class="card-header">
                        <h3><i class="fas fa-shield-alt"></i> Security Settings</h3>
                    </div>
                    <div class="card-content">
                        <div class="security-actions">
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-key"></i>
                                    <div>
                                        <h4>Change Password</h4>
                                        <p>Update your account password</p>
                                    </div>
                                </div>
                                <button class="security-btn" onclick="changePassword()">Change</button>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-mobile-alt"></i>
                                    <div>
                                        <h4>Two-Factor Authentication</h4>
                                        <p>Authenticator App - Enrolled</p>
                                    </div>
                                </div>
                                <div class="security-actions-group">
                                    <button class="security-btn enabled" onclick="manage2FA()">Manage</button>
                                    <button class="security-btn secondary" onclick="showRecoveryCodes()">Show Recovery Codes</button>
                                    <button class="security-btn danger" onclick="regenerateRecoveryCodes()">Regenerate</button>
                                </div>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-devices"></i>
                                    <div>
                                        <h4>Active Sessions & Devices</h4>
                                        <p>3 active sessions</p>
                                    </div>
                                </div>
                                <button class="security-btn" onclick="manageDevices()">Manage</button>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-user-shield"></i>
                                    <div>
                                        <h4>Delegation / Out of Office</h4>
                                        <p>Set approval delegation</p>
                                    </div>
                                </div>
                                <button class="security-btn" onclick="manageDelegation()">Configure</button>
                            </div>
                            
                            <div class="security-item">
                                <div class="security-info">
                                    <i class="fas fa-download"></i>
                                    <div>
                                        <h4>Data Export & Privacy</h4>
                                        <p>Download your data or request account deactivation</p>
                                    </div>
                                </div>
                                <div class="security-actions-group">
                                    <button class="security-btn" onclick="exportData()">Export Data</button>
                                    <button class="security-btn danger" onclick="requestDeactivation()">Deactivate Account</button>
                                </div>
                            </div>
                        </div>
                        <div class="last-updated">Last security review: 1 Dec 2024</div>
                    </div>
                </div>

                <!-- Active Sessions -->
                <div class="profile-card" id="sessions">
                    <div class="card-header">
                        <h3><i class="fas fa-devices"></i> Active Sessions & Devices</h3>
                    </div>
                    <div class="card-content">
                        <div class="sessions-list">
                            <div class="session-item current">
                                <div class="session-info">
                                    <div class="session-icon">
                                        <i class="fas fa-desktop"></i>
                                    </div>
                                    <div class="session-details">
                                        <span class="session-device">Windows 11 - Chrome</span>
                                        <span class="session-location">Jakarta, Indonesia</span>
                                        <span class="session-time">Current session</span>
                                    </div>
                                </div>
                                <span class="current-badge">Current</span>
                            </div>
                            
                            <div class="session-item">
                                <div class="session-info">
                                    <div class="session-icon">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                    <div class="session-details">
                                        <span class="session-device">iPhone 15 - Safari</span>
                                        <span class="session-location">Jakarta, Indonesia</span>
                                        <span class="session-time">2 hours ago</span>
                                    </div>
                                </div>
                                <button class="revoke-btn" onclick="revokeSession('mobile-1')">Sign Out</button>
                            </div>
                            
                            <div class="session-item">
                                <div class="session-info">
                                    <div class="session-icon">
                                        <i class="fas fa-laptop"></i>
                                    </div>
                                    <div class="session-details">
                                        <span class="session-device">MacBook Pro - Safari</span>
                                        <span class="session-location">Bandung, Indonesia</span>
                                        <span class="session-time">1 day ago</span>
                                    </div>
                                </div>
                                <button class="revoke-btn" onclick="revokeSession('laptop-1')">Sign Out</button>
                            </div>
                        </div>
                        
                        <div class="sessions-actions">
                            <button class="revoke-all-btn" onclick="revokeAllSessions()">
                                <i class="fas fa-sign-out-alt"></i>
                                Sign Out All Other Sessions
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Delegation Settings -->
                <div class="profile-card" id="delegation">
                    <div class="card-header">
                        <h3><i class="fas fa-user-shield"></i> Delegation / Out of Office</h3>
                        <div class="card-actions">
                            <button class="edit-btn" onclick="editDelegation()">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="end-delegation-btn" onclick="endDelegationEarly()">
                                <i class="fas fa-stop"></i> End Early
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="delegation-status">
                            <div class="status-indicator active">
                                <i class="fas fa-check-circle"></i>
                                <span>Delegation Active</span>
                            </div>
                            <div class="delegation-period">
                                <span>25 Dec 2024 - 2 Jan 2025</span>
                            </div>
                            <div class="delegation-preview">
                                <div class="preview-box">
                                    <i class="fas fa-info-circle" aria-label="Information"></i>
                                    <span>Requests will be routed to @Sarah Johnson between 25 Dec - 2 Jan</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="delegation-details">
                            <div class="delegate-info">
                                <div class="delegate-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="delegate-details">
                                    <span class="delegate-name">Sarah Johnson</span>
                                    <span class="delegate-role">Senior Manager</span>
                                    <span class="delegate-email">sarah.johnson@company.com</span>
                                </div>
                            </div>
                            
                            <div class="delegation-scope">
                                <h4>Delegation Scope</h4>
                                <div class="scope-items">
                                    <div class="scope-item">
                                        <i class="fas fa-check"></i>
                                        <span>Expense Approvals</span>
                                    </div>
                                    <div class="scope-item">
                                        <i class="fas fa-check"></i>
                                        <span>Travel Requests</span>
                                    </div>
                                    <div class="scope-item">
                                        <i class="fas fa-check"></i>
                                        <span>Budget Adjustments</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="delegation-notifications">
                                <h4>Notifications</h4>
                                <div class="notification-settings">
                                    <div class="notification-item">
                                        <span>Notify delegate of new approvals</span>
                                        <div class="toggle-switch active">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </div>
                                    </div>
                                    <div class="notification-item">
                                        <span>Send me delegation summary</span>
                                        <div class="toggle-switch active">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="last-updated">Delegation set by John Doe on 20 Dec 2024</div>
                    </div>
                </div>

                <!-- App Settings -->
                <div class="profile-card" id="app">
                    <div class="card-header">
                        <h3><i class="fas fa-mobile-alt"></i> App Settings</h3>
                    </div>
                    <div class="card-content">
                        <div class="app-settings">
                            <div class="setting-item">
                                <div class="setting-info">
                                    <span class="setting-title">Dark Mode</span>
                                    <span class="setting-desc">Use dark theme for the app</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <span class="setting-title">Auto-sync</span>
                                    <span class="setting-desc">Automatically sync data when online</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <span class="setting-title">Offline Mode</span>
                                    <span class="setting-desc">Allow app to work offline</span>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logout Section -->
                <div class="profile-card logout-section">
                    <div class="card-content">
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        function changePhoto() {
            alert('Photo change feature coming soon!');
        }
        
        function editPersonalInfo() {
            alert('Personal information edit feature coming soon!');
        }
        
        function editTravelPrefs() {
            alert('Travel preferences edit feature coming soon!');
        }
        
        function changePassword() {
            alert('Change password feature coming soon!');
        }
        
        function enable2FA() {
            alert('Two-Factor Authentication feature coming soon!');
        }
        
        function viewLoginHistory() {
            alert('Login history feature coming soon!');
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear user session
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('loginTime');
                
                // Redirect to login page
                window.location.href = 'login.html';
            }
        }
        
        // Integration functions
        function reconnectIntegration(integrationName) {
            alert(`Reconnecting to ${integrationName}...`);
            // Simulate reconnection process
            setTimeout(() => {
                alert(`Successfully reconnected to ${integrationName}!`);
                location.reload();
            }, 2000);
        }
        
        // MWP Tools functions
        function downloadMWPTemplate() {
            alert('Downloading MWP template...');
            // Create a dummy download
            const link = document.createElement('a');
            link.href = 'data:text/plain;charset=utf-8,MWP Template Content';
            link.download = 'mwp-template.xlsx';
            link.click();
        }
        
        function uploadMWPTemplate() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.xlsx,.xls,.csv';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    alert(`Uploading ${file.name}...`);
                    // Simulate upload process
                    setTimeout(() => {
                        alert('MWP template uploaded successfully!');
                    }, 2000);
                }
            };
            input.click();
        }
        
        function viewMWPStatus() {
            alert('Redirecting to MWP status page...');
            window.location.href = 'mwp.html';
        }
        
        // 2FA functions
        function showRecoveryCodes() {
            // Show recovery codes in a modal
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000';
            
            const content = document.createElement('div');
            content.style.cssText = 'background:white;padding:30px;border-radius:10px;max-width:400px;width:90%';
            content.innerHTML = `
                <h3 style="margin-top:0">Recovery Codes</h3>
                <p style="color:#666;margin-bottom:20px">Save these codes in a secure location. Each code can only be used once.</p>
                <div style="background:#f8f9fa;padding:15px;border-radius:5px;font-family:monospace;margin-bottom:20px">
                    ABC123<br>DEF456<br>GHI789<br>JKL012<br>MNO345<br>PQR678<br>STU901<br>VWX234
                </div>
                <button onclick="this.parentElement.parentElement.remove()" style="background:#667eea;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Close</button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }
        
        function regenerateRecoveryCodes() {
            if (confirm('Are you sure you want to regenerate recovery codes? This will:\n\n• Invalidate all existing codes\n• Force re-login on all sessions\n• Require you to log in again')) {
                alert('Generating new recovery codes and signing out all sessions...');
                // Simulate code generation and force logout
                setTimeout(() => {
                    const codes = ['XYZ789', 'ABC012', 'DEF345', 'GHI678', 'JKL901', 'MNO234', 'PQR567', 'STU890'];
                    alert(`New recovery codes generated:\n${codes.join('\n')}\n\nPlease save these codes securely.\n\nYou will now be logged out from all sessions.`);
                    
                    // Force logout after showing codes
                    setTimeout(() => {
                        localStorage.removeItem('isLoggedIn');
                        localStorage.removeItem('userEmail');
                        window.location.href = 'login.html';
                    }, 3000);
                }, 1500);
            }
        }
        
        // Session management functions
        function signOutOtherSessions() {
            if (confirm('Are you sure you want to sign out all other sessions?')) {
                alert('Signing out other sessions...');
                setTimeout(() => {
                    alert('All other sessions have been signed out successfully!');
                    location.reload();
                }, 2000);
            }
        }
        
        // Delegation functions
        function setDelegate() {
            const delegate = prompt('Enter delegate email:');
            const startDate = prompt('Enter start date (YYYY-MM-DD):');
            const endDate = prompt('Enter end date (YYYY-MM-DD):');
            
            if (delegate && startDate && endDate) {
                alert(`Delegation set:\nDelegate: ${delegate}\nPeriod: ${startDate} to ${endDate}`);
            }
        }
        
        // Data export functions
        function downloadUserData() {
            if (confirm('Download your personal data? This may take a few minutes to prepare.')) {
                alert('Preparing your data export...');
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify({
                        user: 'John Doe',
                        email: 'john.doe@company.com',
                        exportDate: new Date().toISOString(),
                        data: 'User profile and activity data'
                    }, null, 2));
                    link.download = 'my-data-export.json';
                    link.click();
                    alert('Data export downloaded successfully!');
                }, 3000);
            }
        }
        
        function requestAccountDeactivation() {
            if (confirm('Are you sure you want to request account deactivation? This action requires admin approval.')) {
                alert('Account deactivation request submitted. You will receive an email confirmation.');
            }
        }
        
        // Audit trail functions
        function exportAuditLog() {
            alert('Preparing audit log export...');
            setTimeout(() => {
                const link = document.createElement('a');
                link.href = 'data:text/csv;charset=utf-8,Date,Action,User,Status\n2024-12-22,Bank account updated,John Doe,Completed\n2024-12-18,Travel preferences modified,John Doe,Completed';
                link.download = 'audit-log.csv';
                link.click();
                alert('Audit log exported successfully!');
            }, 2000);
        }
        
        // Sensitive data reveal function
          function revealSensitiveData(fieldId, actualValue) {
              const element = document.getElementById(fieldId);
              const revealBtn = element.nextElementSibling.querySelector('.reveal-btn');
              
              // Show actual value
              element.textContent = actualValue;
              revealBtn.innerHTML = '<i class="fas fa-eye-slash"></i> Hide';
              revealBtn.disabled = true;
              
              // Hide after 5 seconds
              setTimeout(() => {
                  if (fieldId === 'accountNumber') {
                      element.textContent = '**** **** **** 4321';
                  } else if (fieldId === 'taxId') {
                      element.textContent = '**.***.***.*-***.***';
                  }
                  revealBtn.innerHTML = '<i class="fas fa-eye"></i> Reveal';
                  revealBtn.disabled = false;
              }, 5000);
          }
          
          // Inline validation functions
          function validateIBAN(iban) {
              const ibanRegex = /^[A-Z]{2}[0-9]{2}[A-Z0-9]{4}[0-9]{7}([A-Z0-9]?){0,16}$/;
              return ibanRegex.test(iban.replace(/\s/g, ''));
          }
          
          function validateSWIFT(swift) {
              const swiftRegex = /^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$/;
              return swiftRegex.test(swift);
          }
          
          function validateNPWP(npwp) {
              const npwpRegex = /^[0-9]{2}\.[0-9]{3}\.[0-9]{3}\.[0-9]{1}-[0-9]{3}\.[0-9]{3}$/;
              return npwpRegex.test(npwp);
          }
          
          function validatePhone(phone) {
              const phoneRegex = /^(\+62|62|0)[0-9]{9,12}$/;
              return phoneRegex.test(phone.replace(/[\s-]/g, ''));
          }
          
          function calculateSimilarity(str1, str2) {
              const longer = str1.length > str2.length ? str1 : str2;
              const shorter = str1.length > str2.length ? str2 : str1;
              const editDistance = levenshteinDistance(longer, shorter);
              return (longer.length - editDistance) / longer.length;
          }
          
          function levenshteinDistance(str1, str2) {
              const matrix = [];
              for (let i = 0; i <= str2.length; i++) {
                  matrix[i] = [i];
              }
              for (let j = 0; j <= str1.length; j++) {
                  matrix[0][j] = j;
              }
              for (let i = 1; i <= str2.length; i++) {
                  for (let j = 1; j <= str1.length; j++) {
                      if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                          matrix[i][j] = matrix[i - 1][j - 1];
                      } else {
                          matrix[i][j] = Math.min(
                              matrix[i - 1][j - 1] + 1,
                              matrix[i][j - 1] + 1,
                              matrix[i - 1][j] + 1
                          );
                      }
                  }
              }
              return matrix[str2.length][str1.length];
          }
          
          function showValidationError(fieldId, message) {
              const field = document.getElementById(fieldId);
              let errorDiv = field.parentNode.querySelector('.validation-error');
              
              if (!errorDiv) {
                  errorDiv = document.createElement('div');
                  errorDiv.className = 'validation-error';
                  field.parentNode.appendChild(errorDiv);
              }
              
              errorDiv.textContent = message;
              errorDiv.style.display = 'block';
              field.style.borderColor = '#dc3545';
          }
          
          function clearValidationError(fieldId) {
              const field = document.getElementById(fieldId);
              const errorDiv = field.parentNode.querySelector('.validation-error');
              
              if (errorDiv) {
                  errorDiv.style.display = 'none';
              }
              field.style.borderColor = '#dee2e6';
          }
          
          function validateField(fieldId, value) {
              switch(fieldId) {
                  case 'bankAccount':
                      if (!validateIBAN(value) && !validateSWIFT(value)) {
                          showValidationError(fieldId, 'Format IBAN atau SWIFT tidak valid');
                          return false;
                      }
                      break;
                  case 'taxId':
                      if (!validateNPWP(value)) {
                          showValidationError(fieldId, 'Format NPWP tidak valid (XX.XXX.XXX.X-XXX.XXX)');
                          return false;
                      }
                      break;
                  case 'accountHolder':
                      const employeeName = 'John Doe'; // This should come from user data
                      const similarity = calculateSimilarity(value.toLowerCase(), employeeName.toLowerCase());
                      if (similarity < 0.7) {
                          showValidationError(fieldId, 'Nama rekening harus mirip dengan nama karyawan');
                          return false;
                      }
                      break;
                  case 'phone':
                      if (!validatePhone(value)) {
                          showValidationError(fieldId, 'Format nomor telepon tidak valid');
                          return false;
                      }
                      break;
              }
              clearValidationError(fieldId);
              return true;
          }
         
         // Test notification functions
         function testEmailNotification() {
             alert('Test email notification sent to john.doe@company.com');
         }
         
         function testPushNotification() {
             alert('Test push notification sent to your devices');
         }
         
         function testSlackNotification() {
             alert('Test Slack notification sent to #travel-expenses channel');
         }
         
         // Integration functions
         function viewIntegrationLogs(integration) {
             alert(`Viewing ${integration} integration logs...\n\nLast 10 events:\n• Sync completed - 2 hours ago\n• Data updated - 4 hours ago\n• Connection verified - 1 day ago`);
         }
         
         // MWP functions
         function openValidationResults() {
             alert('Opening MWP validation results page...');
             window.open('mwp-validation.html', '_blank');
         }
         
         // Delegation functions
         function endDelegationEarly() {
             if (confirm('Are you sure you want to end the delegation early?')) {
                 alert('Delegation ended successfully. Audit entry created.');
                 location.reload();
             }
         }
         
         // Removed duplicate DOMContentLoaded - consolidated at the end of file
         
         // Smooth scroll for navigation links
           document.querySelectorAll('.subnav a').forEach(link => {
               link.addEventListener('click', function(e) {
                   e.preventDefault();
                   const targetId = this.getAttribute('href').substring(1);
                   const targetElement = document.getElementById(targetId);
                   if (targetElement) {
                       targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                   }
               });
           });
           
           // Re-authentication for sensitive data changes
           function requireReAuth(callback) {
               const modal = document.createElement('div');
               modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000';
               
               const content = document.createElement('div');
               content.style.cssText = 'background:white;padding:30px;border-radius:10px;max-width:400px;width:90%';
               content.innerHTML = `
                   <h3 style="margin-top:0">Konfirmasi Identitas</h3>
                   <p style="color:#666;margin-bottom:20px">Masukkan password untuk mengonfirmasi perubahan data sensitif.</p>
                   <input type="password" id="reAuthPassword" placeholder="Password" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:15px">
                   <div style="display:flex;gap:10px;justify-content:flex-end">
                       <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background:#6c757d;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Batal</button>
                       <button onclick="confirmReAuth()" style="background:#667eea;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Konfirmasi</button>
                   </div>
               `;
               
               modal.appendChild(content);
               document.body.appendChild(modal);
               
               window.confirmReAuth = function() {
                   const password = document.getElementById('reAuthPassword').value;
                   if (password === 'password123') { // Mock validation
                       modal.remove();
                       callback();
                       showToast('Perubahan berhasil disimpan', 'success');
                   } else {
                       showToast('Password salah', 'error');
                   }
               };
           }
           
           // Toast notification function
           function showToast(message, type = 'success') {
               const toast = document.createElement('div');
               toast.className = `toast ${type}`;
               toast.textContent = message;
               document.body.appendChild(toast);
               
               setTimeout(() => toast.classList.add('show'), 100);
               setTimeout(() => {
                   toast.classList.remove('show');
                   setTimeout(() => toast.remove(), 300);
               }, 3000);
           }
           
           // Back to top functionality
           function initBackToTop() {
               const backToTopBtn = document.createElement('button');
               backToTopBtn.className = 'back-to-top';
               backToTopBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
               backToTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
               document.body.appendChild(backToTopBtn);
               
               window.addEventListener('scroll', () => {
                   if (window.pageYOffset > 300) {
                       backToTopBtn.classList.add('show');
                   } else {
                       backToTopBtn.classList.remove('show');
                   }
               });
           }
           
           // Session management with warnings
           function checkOldSessions() {
               const sessions = [
                   { device: 'Windows 11 - Chrome', lastActive: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000) },
                   { device: 'iPhone 13 - Safari', lastActive: new Date(Date.now() - 35 * 24 * 60 * 60 * 1000) },
                   { device: 'MacBook - Firefox', lastActive: new Date(Date.now() - 45 * 24 * 60 * 60 * 1000) }
               ];
               
               const oldSessions = sessions.filter(session => {
                   const daysDiff = (Date.now() - session.lastActive.getTime()) / (1000 * 60 * 60 * 24);
                   return daysDiff > 30;
               });
               
               if (oldSessions.length > 0) {
                   const message = `Peringatan: ${oldSessions.length} sesi aktif lebih dari 30 hari. Disarankan untuk sign out.`;
                   showToast(message, 'error');
               }
           }
           
           // Initialize all functions on page load
           document.addEventListener('DOMContentLoaded', function() {
               initBackToTop();
               checkOldSessions();
               
               // Add validation to form fields
               const fieldsToValidate = ['bankAccount', 'taxId', 'accountHolder', 'phone'];
               fieldsToValidate.forEach(fieldId => {
                   const field = document.getElementById(fieldId);
                   if (field) {
                       field.addEventListener('blur', function() {
                           validateField(fieldId, this.value);
                       });
                   }
               });
           });
           
           // Save sensitive data with re-auth
           function saveSensitiveData(fieldType, value) {
               requireReAuth(() => {
                   // Mock save operation
                   console.log(`Saving ${fieldType}: ${value}`);
               });
           }
           
           // Edit sensitive field with modal
           function editSensitiveField(fieldId, fieldName) {
               const modal = document.createElement('div');
               modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000';
               
               const content = document.createElement('div');
               content.style.cssText = 'background:white;padding:30px;border-radius:10px;max-width:500px;width:90%';
               content.innerHTML = `
                   <h3 style="margin-top:0">Edit ${fieldName}</h3>
                   <p style="color:#666;margin-bottom:20px">Masukkan nilai baru untuk ${fieldName.toLowerCase()}.</p>
                   <input type="text" id="newSensitiveValue" placeholder="${fieldName}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:15px">
                   <div class="validation-error" style="color:#dc3545;font-size:14px;margin-bottom:15px;display:none"></div>
                   <div style="display:flex;gap:10px;justify-content:flex-end">
                       <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background:#6c757d;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Batal</button>
                       <button onclick="saveSensitiveFieldValue('${fieldId}', '${fieldName}')" style="background:#667eea;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer">Simpan</button>
                   </div>
               `;
               
               modal.appendChild(content);
               document.body.appendChild(modal);
               
               // Focus on input
               setTimeout(() => {
                   document.getElementById('newSensitiveValue').focus();
               }, 100);
           }
           
           // Save sensitive field value with validation and re-auth
           function saveSensitiveFieldValue(fieldId, fieldName) {
               const newValue = document.getElementById('newSensitiveValue').value;
               const errorDiv = document.querySelector('.validation-error');
               
               // Validate the input
               if (!validateField(fieldId, newValue)) {
                   return; // Validation failed, error already shown
               }
               
               // Close modal and require re-auth
               document.querySelector('[style*="position:fixed"]').remove();
               
               requireReAuth(() => {
                   // Update the masked display
                   const element = document.getElementById(fieldId);
                   if (fieldId === 'bankAccount') {
                       element.textContent = '****-****-' + newValue.slice(-4);
                   } else if (fieldId === 'taxId') {
                       element.textContent = '**.***.***.*-***.***';
                   }
                   
                   showToast(`${fieldName} berhasil diperbarui`, 'success');
                   
                   // Update last modified info
                   const lastUpdated = element.closest('.profile-card').querySelector('.last-updated');
                   if (lastUpdated) {
                       lastUpdated.textContent = `Last updated by John Doe on ${new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })}`;
                   }
               });
           }
    </script>
    
    <style>
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .profile-avatar {
            position: relative;
        }
        
        .profile-avatar img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #667eea;
        }
        
        .change-photo-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .profile-info h1 {
            color: #333;
            margin-bottom: 5px;
            font-size: 1.8rem;
        }
        
        .job-title {
            color: #667eea;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .department {
            color: #666;
            margin-bottom: 5px;
        }
        
        .employee-id {
            color: #999;
            font-size: 0.9rem;
            font-family: monospace;
        }
        
        .profile-stats {
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #f0f4ff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-icon i {
            color: #667eea;
            font-size: 1.2rem;
        }
        
        .stat-content {
            display: flex;
            flex-direction: column;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .profile-sections {
            display: grid;
            gap: 12px;
        }
        
        @media (max-width: 768px) {
            .profile-sections {
                gap: 1rem;
            }
            
            .profile-card {
                margin-bottom: 1rem;
            }
        }
        
        .profile-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            scroll-margin-top: 90px;
            margin-bottom: 24px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #f0f0f0;
        }
        
        @media (max-width: 768px) {
            .card-header {
                padding: 1.25rem;
            }
        }
        
        .card-header h3 {
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
            font-size: 1.2rem;
        }
        
        .edit-btn {
            background: #f8f9fa;
            color: #667eea;
            border: 1px solid #dee2e6;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .edit-btn:hover {
            background: #e9ecef;
        }
        
        .card-content {
            padding: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .card-content {
                padding: 1.25rem;
            }
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 60px;
        }
        
        .info-item label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .info-item span {
            color: #333;
            font-size: 1rem;
        }
        
        .budget-overview {
            display: grid;
            gap: 20px;
        }
        
        .budget-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .budget-title {
            color: #333;
            font-weight: 500;
        }
        
        .budget-amount {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .budget-progress {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            color: #666;
            font-size: 0.9rem;
        }
        
        .notification-settings, .app-settings {
            display: grid;
            gap: 15px;
        }
        
        .notification-matrix {
            margin-bottom: 30px;
        }
        
        .matrix-header {
            display: grid;
            grid-template-columns: 1fr 200px;
            align-items: center;
            padding: 15px 0;
            border-bottom: 2px solid #e0e0e0;
            font-weight: 600;
            color: #333;
        }
        
        .matrix-channels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
        }
        
        .channel-header {
            font-size: 14px;
            color: #666;
        }
        
        .matrix-row {
            display: grid;
            grid-template-columns: 1fr 200px;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .matrix-row:last-child {
            border-bottom: none;
        }
        
        .matrix-label {
            display: flex;
            flex-direction: column;
        }
        
        .notification-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }
        
        .notification-desc {
            font-size: 14px;
            color: #666;
        }
        
        .toggle-switch.mini {
            transform: scale(0.8);
        }
        
        .notification-schedule {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .notification-schedule h4 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 16px;
        }
        
        .schedule-settings {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .schedule-info {
            display: flex;
            flex-direction: column;
        }
        
        .schedule-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }
        
        .schedule-desc {
            font-size: 14px;
            color: #666;
        }
        
        .time-range {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-select, .digest-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            color: #333;
        }
        
        .time-range span {
            color: #666;
            font-size: 14px;
        }
        
        .last-updated {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 12px;
            color: #999;
            text-align: right;
        }
        
        .permissions-section, .audit-section {
            margin-bottom: 30px;
        }
        
        .permissions-section h4, .audit-section h4 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 16px;
        }
        
        .permissions-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .permission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .permission-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .permission-field {
            font-weight: 500;
            color: #333;
        }
        
        .permission-desc {
            font-size: 14px;
            color: #666;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge.editable {
            background: #d4edda;
            color: #155724;
        }
        
        .badge.managed {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge.restricted {
            background: #f8d7da;
            color: #721c24;
        }
        
        .audit-trail {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .audit-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .audit-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .audit-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .audit-action {
            font-weight: 500;
            color: #333;
        }
        
        .audit-meta {
            font-size: 14px;
            color: #666;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .status-badge.sensitive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-badge.normal {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-badge.security {
            background: #d4edda;
            color: #155724;
        }
        
        .audit-actions {
            display: flex;
            justify-content: flex-end;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .setting-title {
            color: #333;
            font-weight: 500;
        }
        
        .setting-desc {
            color: #666;
            font-size: 0.9rem;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .security-actions {
            display: grid;
            gap: 10px;
        }
        
        .security-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            width: 100%;
        }
        
        .security-btn:hover {
            background: #e9ecef;
        }
        
        .security-btn i:first-child {
            color: #667eea;
            font-size: 1.2rem;
            width: 20px;
        }
        
        .btn-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .btn-title {
            color: #333;
            font-weight: 500;
        }
        
        .btn-desc {
            color: #666;
            font-size: 0.9rem;
        }
        
        .security-btn i:last-child {
            color: #999;
        }
        
        /* Integration Actions */
        .integration-actions {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 8px;
        }
        
        .reconnect-btn, .view-logs-btn {
            padding: 6px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: #f8f9fa;
            color: #495057;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reconnect-btn:hover, .view-logs-btn:hover {
            background: #e9ecef;
        }
        
        /* MWP Tool Buttons */
        .tool-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .tool-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: 1px solid #667eea;
            border-radius: 8px;
            background: #667eea;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        
        .tool-btn:hover {
            background: #5a67d8;
            border-color: #5a67d8;
        }
        
        .tool-btn.secondary {
            grid-column: 1 / -1;
            background: #f8f9fa;
            color: #495057;
            border-color: #dee2e6;
        }
        
        .tool-btn.secondary:hover {
            background: #e9ecef;
        }
        
        .tool-btn i {
            font-size: 0.9rem;
        }
        
        @media (max-width: 420px) {
             .integration-actions {
                 flex-direction: column;
                 gap: 6px;
                 margin-top: 0.5rem;
             }
             
             .reconnect-btn, .view-logs-btn {
                 width: 100%;
                 font-size: 0.8rem;
                 padding: 8px 12px;
                 min-height: 44px;
             }
         }
         
         @media (min-width: 421px) and (max-width: 576px) {
             .integration-actions {
                 flex-direction: row;
                 gap: 8px;
             }
             
             .reconnect-btn, .view-logs-btn {
                 flex: 1;
                 font-size: 0.8rem;
                 padding: 5px 8px;
             }
            
            .tool-buttons {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
            
            .tool-btn.secondary {
                grid-column: 1;
            }
        }
        
        .logout-section {
            border: 1px solid #dc3545;
        }
        
        .logout-btn {
            width: 100%;
            padding: 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: #c82333;
        }
        
        /* Disabled button styling */
        .reveal-btn:disabled {
            background: #f8f9fa;
            color: #6c757d;
            border-color: #dee2e6;
            cursor: not-allowed;
            opacity: 0.8;
            position: relative;
        }
        
        .reveal-btn:disabled:hover {
            background: #f8f9fa;
        }
        
        .reveal-btn:disabled::after {
            content: 'Finance can share on request';
            position: absolute;
            bottom: -20px;
            left: 0;
            font-size: 0.75rem;
            color: #6c757d;
            white-space: nowrap;
        }
        
        /* Info icon for restricted fields */
        .restricted-info {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #6c757d;
            font-size: 0.8rem;
        }
        
        .restricted-info i {
            color: #adb5bd;
            cursor: help;
        }
        
        /* Emergency contact styling */
        .emergency-contact {
            border-left: 3px solid #dc3545;
            padding-left: 12px;
        }
        
        .emergency-contact label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #dc3545;
            font-weight: 600;
        }
        
        .contact-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .contact-details strong {
            font-size: 1rem;
            color: #333;
        }
        
        .phone-link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .phone-link:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 480px) {
            .card-header h3 {
                font-size: 1rem;
            }
            
            .card-header {
                padding: 1rem;
            }
            
            .card-content {
                padding: 1rem;
            }
            
            /* Optimize header height on mobile */
            .header {
                height: 56px;
                padding: 8px 0;
            }
            
            .header .container {
                padding: 0 16px;
            }
            
            .header .logo span {
                font-size: 1.1rem;
            }
            
            .header .user-info {
                font-size: 0.85rem;
            }
            
            .header .user-info span {
                display: none;
            }
            
            .header .user-info i {
                font-size: 1.5rem;
            }
            
            .emergency-contact {
                border-left-width: 2px;
                padding-left: 8px;
            }
        }
        
        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .card-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .card-header .badge-row {
                width: 100%;
                justify-content: flex-start;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .budget-header {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }
            
            .setting-item {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }
        
        /* Sticky Sub Navigation - Completely fixed blur issue */
        .subnav {
            position: sticky;
            top: 0;
            z-index: 110;
            background: #ffffff !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            filter: none !important;
            border: 1px solid #e5e9f2;
            border-radius: 10px;
            padding: 6px 8px;
            display: flex;
            gap: 8px;
            overflow: visible;
            margin-bottom: 20px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.1);
            align-items: center;
            height: 56px;
            white-space: nowrap;
            isolation: isolate;
        }
        
        .subnav::before,
        .subnav::after {
            display: none !important;
            height: 0 !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            filter: none !important;
        }
        
        .subnav-more {
            position: relative;
            display: none;
        }
        
        .more-btn {
            background: none;
            border: none;
            padding: 8px 12px;
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            min-height: 44px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .more-btn:hover {
            background: #f8f9fa;
        }
        
        .more-btn i {
            font-size: 12px;
            transition: transform 0.2s;
        }
        
        .more-btn[aria-expanded="true"] {
            background: #eef2ff;
            color: #667eea;
        }
        
        .more-btn[aria-expanded="true"] i {
            transform: rotate(180deg);
        }
        
        .more-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e5e9f2;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            min-width: 160px;
            display: none;
            z-index: 9999;
            margin-top: 4px;
            filter: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }
        
        .more-dropdown.show {
            display: block;
        }
        
        .more-dropdown a {
            display: block;
            padding: 12px 16px;
            color: #666;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            border-bottom: 1px solid #f3f4f6;
            min-height: 44px;
            align-items: center;
        }
        
        .more-dropdown a:last-child {
            border-bottom: none;
        }
        
        .more-dropdown a:hover {
            background: #f8f9fa;
            color: #667eea;
        }
        
        .subnav::-webkit-scrollbar {
            display: none;
        }
        
        .subnav a {
            padding: 8px 12px;
            border-radius: 8px;
            text-decoration: none;
            color: #666;
            font-size: 0.9rem;
            white-space: nowrap;
            transition: all 0.2s ease;
            flex-shrink: 0;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            scroll-snap-align: start;
        }
        
        .subnav a:hover {
            background: #f8f9fa;
        }
        
        .subnav a.active {
            background: #eef2ff;
            font-weight: 700;
            color: #667eea;
        }
        
        /* Show More dropdown on desktop and tablet */
        @media (min-width: 769px) {
            .subnav-more {
                display: flex;
            }
        }
        
        /* Tablet: Scrollable chips - fixed overflow */
        @media (min-width: 769px) and (max-width: 1199px) {
            .subnav {
                overflow-x: auto;
                overflow-y: visible;
                scroll-snap-type: x mandatory;
                padding-bottom: 8px;
            }
            
            .subnav a {
                scroll-snap-align: start;
            }
            
            .subnav::-webkit-scrollbar {
                height: 4px;
                display: block;
            }
            
            .subnav::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 2px;
            }
            
            .subnav::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 2px;
            }
            
            .subnav::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }
        }
        
        /* Hard reset for blurred areas */
        .profile-header, .profile-stats, #personal .profile-card {
            filter: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            opacity: 1 !important;
        }
        
        /* Mobile: Dropdown fallback */
        @media (max-width: 768px) {
            .subnav {
                display: none;
            }
            
            .subnav-dropdown {
                display: block !important;
                position: sticky;
                top: 0;
                z-index: 100;
                background: #fff;
                border: 1px solid #e5e9f2;
                border-radius: 10px;
                padding: 8px;
                margin-bottom: 20px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .subnav-select {
                width: 100%;
                padding: 12px 16px;
                border: none;
                background: transparent;
                font-size: 0.9rem;
                color: #666;
                min-height: 44px;
            }
        }
        
        /* Removed duplicate .subnav media query - consolidated above */
        
        /* Admin Badge */
        .badge-admin {
            font-size: 0.75rem;
            padding: 6px 12px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 999px;
            color: #856404;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            min-height: 28px;
        }
        
        .badge-admin i {
            font-size: 0.7rem;
        }
        
        /* Badge row container */
        .badge-row {
            min-height: 44px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        /* Badge overflow handling */
        .badge-admin, .badge.restricted {
            display: inline-flex;
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .badge.restricted {
            white-space: nowrap;
        }
        
        @media (max-width: 420px) {
            .badge-admin, .badge.restricted {
                max-width: 200px;
                font-size: 0.7rem;
            }
        }
        
        /* Restricted badge styling */
        .badge.restricted {
            background: #dc2626;
            color: #ffffff;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            min-height: 28px;
            margin-left: 8px;
        }
        
        .badge.restricted i {
            font-size: 0.7rem;
        }
        
        /* Locked State Styling */
        .info-grid.locked,
        .budget-overview.locked {
            opacity: 0.8;
            pointer-events: none;
        }
        
        .info-item.locked {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            cursor: not-allowed;
        }
        
        .info-item.locked label {
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .info-item.locked span {
            color: #6c757d;
        }
        
        .lock-icon {
            font-size: 0.7rem;
            color: #adb5bd;
        }
        
        /* Locked field visual improvements */
        .info-item.locked input,
        .info-item.locked select {
            background: #f8f9fa;
            border-color: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .info-item.locked::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(248, 249, 250, 0.3);
            pointer-events: none;
            border-radius: 6px;
        }

        .tooltip-icon {
            color: #6b7280;
            font-size: 12px;
            margin-left: 4px;
            cursor: help;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .tooltip-icon:hover {
            opacity: 1;
            color: #3b82f6;
        }
        
        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .skeleton-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .skeleton-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }
        
        .skeleton-title {
            height: 20px;
            width: 150px;
            border-radius: 4px;
        }
        
        .skeleton-line {
            height: 16px;
            border-radius: 4px;
            margin-bottom: 12px;
        }
        
        .skeleton-line.short { width: 60%; }
        .skeleton-line.medium { width: 80%; }
        .skeleton-line.long { width: 100%; }
        
        .skeleton-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        
        .skeleton-item {
            padding: 16px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        .skeleton-item .skeleton-line:first-child {
            width: 40%;
            margin-bottom: 8px;
        }
        
        .skeleton-item .skeleton-line:last-child {
            width: 70%;
            margin-bottom: 0;
        }
        
        /* Sensitive Data Styling */
        .reveal-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            color: #667eea;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reveal-btn:hover {
            background: #e9ecef;
        }
        
        .reveal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .helper-text {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 4px;
        }
        
        /* Last Updated Styling */
        .last-updated {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        
        /* Security Button Styling */
        .security-btn.danger {
            background: #fee;
            border-color: #fcc;
            color: #c33;
        }
        
        .security-btn.danger:hover {
            background: #fdd;
        }
        
        /* Test Notification Buttons */
        .test-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            color: #667eea;
            cursor: pointer;
            margin-left: 8px;
        }
        
        .test-btn:hover {
            background: #e9ecef;
        }
        
        /* Delegation Preview */
        .delegation-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .delegation-preview h5 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 0.9rem;
        }
        
        .delegation-flow {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .delegation-flow .arrow {
             color: #667eea;
         }
         
         /* Validation Error Styling */
         .validation-error {
             display: none;
             color: #dc3545;
             font-size: 0.8rem;
             margin-top: 4px;
             padding: 4px 8px;
             background: #f8d7da;
             border: 1px solid #f5c6cb;
             border-radius: 4px;
         }
         
         /* Disabled field styling */
         .info-item input:disabled,
         .info-item select:disabled {
             background-color: #f8f9fa;
             color: #6c757d;
             cursor: not-allowed;
             opacity: 0.7;
         }
         
         /* Tooltip styling */
         .tooltip {
             position: relative;
             display: inline-block;
             cursor: help;
         }
         
         .tooltip .tooltiptext {
             visibility: hidden;
             width: 200px;
             background-color: #333;
             color: #fff;
             text-align: center;
             border-radius: 6px;
             padding: 8px;
             position: absolute;
             z-index: 1;
             bottom: 125%;
             left: 50%;
             margin-left: -100px;
             font-size: 0.8rem;
             opacity: 0;
             transition: opacity 0.3s;
         }
         
         .tooltip:hover .tooltiptext {
             visibility: visible;
             opacity: 1;
         }
         
         /* Toast notification */
         .toast {
             position: fixed;
             top: 20px;
             right: 20px;
             padding: 12px 20px;
             border-radius: 8px;
             color: white;
             font-weight: 500;
             z-index: 1000;
             transform: translateX(400px);
             transition: transform 0.3s ease;
         }
         
         .toast.success {
             background-color: #28a745;
         }
         
         .toast.error {
             background-color: #dc3545;
         }
         
         .toast.show {
             transform: translateX(0);
         }
         
         /* Back to top button */
         .back-to-top {
             position: fixed;
             bottom: 20px;
             right: 20px;
             width: 50px;
             height: 50px;
             background: #667eea;
             color: white;
             border: none;
             border-radius: 50%;
             cursor: pointer;
             display: none;
             align-items: center;
             justify-content: center;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
             transition: all 0.3s ease;
         }
         
         .back-to-top:hover {
             background: #5a67d8;
             transform: translateY(-2px);
         }
         
         .back-to-top.show {
             display: flex;
         }
         
         /* Toast notifications */
         .toast {
             position: fixed;
             top: 20px;
             right: 20px;
             padding: 15px 20px;
             border-radius: 8px;
             color: white;
             font-weight: 500;
             z-index: 1001;
             transform: translateX(400px);
             transition: transform 0.3s ease;
             max-width: 300px;
             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
         }
         
         .toast.show {
             transform: translateX(0);
         }
         
         .toast.success {
             background: #10b981;
         }
         
         .toast.error {
             background: #ef4444;
         }
         
         .toast.warning {
             background: #f59e0b;
         }
         
         .toast.info {
             background: #3b82f6;
         }
         
         /* Sensitive data styling */
         .sensitive-data {
             display: flex;
             align-items: center;
             gap: 10px;
             flex-wrap: wrap;
         }
         
         .btn-secondary {
             background: #6c757d;
             color: white;
             border: none;
             padding: 6px 12px;
             border-radius: 4px;
             cursor: pointer;
             font-size: 12px;
             transition: background-color 0.2s;
         }
         
         .btn-secondary:hover {
             background: #5a6268;
         }
         
         .btn-secondary i {
             margin-right: 4px;
         }
         
         /* Modal styling improvements */
         .modal-overlay {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0,0,0,0.5);
             display: flex;
             align-items: center;
             justify-content: center;
             z-index: 1000;
         }
         
         .modal-content {
             background: white;
             padding: 30px;
             border-radius: 10px;
             max-width: 500px;
             width: 90%;
             box-shadow: 0 10px 25px rgba(0,0,0,0.2);
         }
         
         .modal-input {
             width: 100%;
             padding: 10px;
             border: 1px solid #ddd;
             border-radius: 5px;
             margin-bottom: 15px;
             font-size: 14px;
         }
         
         .modal-input:focus {
             outline: none;
             border-color: #667eea;
             box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
         }
         
         .modal-buttons {
             display: flex;
             gap: 10px;
             justify-content: flex-end;
         }
         
         .modal-btn {
             border: none;
             padding: 10px 20px;
             border-radius: 5px;
             cursor: pointer;
             font-weight: 500;
             transition: all 0.2s;
         }
         
         .modal-btn.cancel {
             background: #6c757d;
             color: white;
         }
         
         .modal-btn.cancel:hover {
             background: #5a6268;
         }
         
         .modal-btn.primary {
             background: #667eea;
             color: white;
         }
         
         .modal-btn.primary:hover {
             background: #5a67d8;
         }
         
         /* Profile Section Styling */
         .profile-section {
             margin-bottom: 40px;
         }
         
         .section-header {
             margin-bottom: 24px;
             text-align: center;
         }
         
         .section-header h2 {
             color: #333;
             font-size: 1.5rem;
             margin-bottom: 8px;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 12px;
         }
         
         .section-desc {
             color: #666;
             font-size: 0.9rem;
             margin: 0;
         }
         
         /* Profile Grid Layout */
        .profile-grid {
            display: block;
        }
        
        .profile-grid .profile-card {
            margin-bottom: 16px;
        }
        
        /* Mobile spacing improvements */
        @media (max-width: 768px) {
            .profile-card {
                margin-bottom: 1.25rem;
            }
            
            .profile-card:last-child {
                margin-bottom: 5rem;
            }
        }
        
        /* Button group improvements */
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }
        
        @media (max-width: 400px) {
            .btn-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .btn-group .btn {
                width: 100%;
                min-height: 44px;
            }
        }
         
         @media (min-width: 768px) {
             .profile-grid {
                 display: grid;
                 grid-template-columns: 1fr 1fr;
                 gap: 24px;
             }
         }
         
         /* Card Styling */
         .locked-card {
             background: #f9fafb;
             border: 1px solid #e5e7eb;
         }
         
         .restricted-card {
             border: 2px solid #ef4444;
             background: #fef2f2;
         }
         
         /* Badge Styling */
         .admin-badge {
             background: #fbbf24;
             color: #92400e;
             padding: 4px 8px;
             border-radius: 12px;
             font-size: 0.75rem;
             font-weight: 600;
             display: flex;
             align-items: center;
             gap: 4px;
         }
         
         .restricted-badge {
             background: #ef4444;
             color: white;
             padding: 4px 8px;
             border-radius: 12px;
             font-size: 0.75rem;
             font-weight: 600;
             display: flex;
             align-items: center;
             gap: 4px;
         }
         
         /* Locked Field Styling */
         .info-item.locked {
             background: #f9fafb;
             border-radius: 6px;
             padding: 12px;
             cursor: not-allowed;
         }
         
         .info-item.locked label {
             color: #6b7280;
             display: flex;
             align-items: center;
             gap: 6px;
         }
         
         .info-item.locked span {
             color: #374151;
         }
         
         /* Editable Field Styling */
         .info-item.editable:hover {
             background: #f3f4f6;
             border-radius: 6px;
             cursor: pointer;
         }
         
         .editable-field {
             transition: all 0.2s ease;
         }
         
         .editable-field:focus {
             outline: 2px solid #3b82f6;
             border-radius: 4px;
         }
         
         .full-width {
             grid-column: 1 / -1;
         }
         
         /* Emergency Contact Styling */
         .emergency-contact {
             border: 2px solid #ef4444;
             border-radius: 8px;
             padding: 12px;
             background: #fef2f2;
         }
         
         .emergency-contact label {
             color: #dc2626;
             font-weight: 600;
             display: flex;
             align-items: center;
             gap: 6px;
             margin-bottom: 8px;
         }
         
         .contact-details {
             display: flex;
             flex-direction: column;
             gap: 4px;
         }
         
         .contact-details strong {
             color: #dc2626;
             font-size: 1.1rem;
         }
         
         .contact-details .relation {
             color: #7f1d1d;
             font-style: italic;
             font-size: 0.9rem;
         }
         
         .phone-link {
             color: #dc2626;
             text-decoration: none;
             font-weight: 500;
         }
         
         .phone-link:hover {
             text-decoration: underline;
         }
         
         /* Document Upload Styling */
         .document-grid {
             display: grid;
             gap: 20px;
         }
         
         .document-item {
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             padding: 16px;
         }
         
         .document-item label {
             font-weight: 600;
             color: #374151;
             margin-bottom: 12px;
             display: block;
         }
         
         .document-upload {
             display: flex;
             align-items: center;
             gap: 16px;
         }
         
         .document-preview {
             width: 80px;
             height: 50px;
             border: 1px solid #d1d5db;
             border-radius: 4px;
             overflow: hidden;
             display: flex;
             align-items: center;
             justify-content: center;
         }
         
         .doc-thumbnail {
             width: 100%;
             height: 100%;
             object-fit: cover;
         }
         
         .doc-placeholder {
             display: flex;
             flex-direction: column;
             align-items: center;
             justify-content: center;
             color: #9ca3af;
             font-size: 0.75rem;
             text-align: center;
             padding: 8px;
         }
         
         .doc-placeholder i {
             font-size: 1.2rem;
             margin-bottom: 4px;
         }
         
         .document-status {
             display: flex;
             flex-direction: column;
             gap: 8px;
         }
         
         .badge {
             padding: 4px 8px;
             border-radius: 12px;
             font-size: 0.75rem;
             font-weight: 600;
             display: inline-flex;
             align-items: center;
             gap: 4px;
             width: fit-content;
         }
         
         .badge.uploaded {
             background: #d1fae5;
             color: #065f46;
         }
         
         .badge.missing {
             background: #fee2e2;
             color: #991b1b;
         }
         
         .upload-btn {
             background: #3b82f6;
             color: white;
             border: none;
             padding: 6px 12px;
             border-radius: 6px;
             font-size: 0.8rem;
             cursor: pointer;
             transition: background 0.2s ease;
         }
         
         .upload-btn:hover {
             background: #2563eb;
         }
         
         /* Approval Chain Styling */
         .approval-chain {
             margin-top: 16px;
         }
         
         .approval-chain label {
             font-weight: 600;
             color: #374151;
             margin-bottom: 12px;
             display: block;
         }
         
         .approver-list {
             display: flex;
             flex-direction: column;
             gap: 12px;
         }
         
         .approver-item {
             display: flex;
             align-items: center;
             gap: 12px;
             padding: 12px;
             background: white;
             border-radius: 8px;
             border: 1px solid #e5e7eb;
         }
         
         .approver-number {
             font-size: 1.2rem;
         }
         
         .approver-info {
             display: flex;
             align-items: center;
             gap: 12px;
             flex: 1;
         }
         
         .approver-avatar {
             width: 32px;
             height: 32px;
             border-radius: 50%;
             overflow: hidden;
         }
         
         .approver-avatar img {
             width: 100%;
             height: 100%;
             object-fit: cover;
         }
         
         .approver-details {
             display: flex;
             flex-direction: column;
         }
         
         .approver-details strong {
             color: #374151;
             font-size: 0.9rem;
         }
         
         .approver-details span {
             color: #6b7280;
             font-size: 0.8rem;
         }
         
         .approval-arrow {
             text-align: center;
             color: #6b7280;
             font-size: 1.2rem;
             margin: 4px 0;
         }
         
         /* Restricted Information Styling */
         .restricted-notice {
             display: flex;
             align-items: flex-start;
             gap: 12px;
             padding: 16px;
             background: #fee2e2;
             border: 1px solid #fecaca;
             border-radius: 8px;
             margin-bottom: 16px;
         }
         
         .restricted-notice i {
             color: #dc2626;
             font-size: 1.2rem;
             margin-top: 2px;
         }
         
         .restricted-notice strong {
             color: #dc2626;
             font-size: 0.9rem;
             display: block;
             margin-bottom: 4px;
         }
         
         .restricted-notice p {
             color: #7f1d1d;
             font-size: 0.8rem;
             margin: 0;
         }
         
         .info-item.restricted {
             background: #fef2f2;
             border: 1px solid #fecaca;
         }
         
         .masked-data {
             cursor: pointer;
             display: flex;
             align-items: center;
             gap: 8px;
             color: #6b7280;
             font-family: monospace;
         }
         
         .masked-data:hover {
             color: #374151;
         }
         
         .masked-data i {
             font-size: 0.8rem;
         }
         
         /* Action Buttons */
         .card-actions {
             margin-top: 16px;
             display: flex;
             gap: 12px;
             justify-content: flex-end;
         }
         
         .save-btn {
             background: #10b981;
             color: white;
             border: none;
             padding: 8px 16px;
             border-radius: 6px;
             font-size: 0.9rem;
             cursor: pointer;
             transition: background 0.2s ease;
         }
         
         .save-btn:hover {
             background: #059669;
         }
         
         .cancel-btn {
             background: #6b7280;
             color: white;
             border: none;
             padding: 8px 16px;
             border-radius: 6px;
             font-size: 0.9rem;
             cursor: pointer;
             transition: background 0.2s ease;
         }
         
         .cancel-btn:hover {
             background: #4b5563;
         }
         
         .request-change-btn {
             background: #f59e0b;
             color: white;
             border: none;
             padding: 8px 16px;
             border-radius: 6px;
             font-size: 0.9rem;
             cursor: pointer;
             transition: background 0.2s ease;
             margin-top: 16px;
             display: flex;
             align-items: center;
             gap: 8px;
         }
         
         .request-change-btn:hover {
             background: #d97706;
         }
         
         .contact-finance-btn {
             background: #dc2626;
             color: white;
             border: none;
             padding: 8px 16px;
             border-radius: 6px;
             font-size: 0.9rem;
             cursor: pointer;
             transition: background 0.2s ease;
             margin-top: 16px;
             display: flex;
             align-items: center;
             gap: 8px;
         }
         
         .contact-finance-btn:hover {
            background: #b91c1c;
        }
        
        /* Fix blur issues - comprehensive blur removal */
        body,
        html,
        .main-content,
        .container,
        .header,
        .profile-card,
        .card-header,
        .card-content,
        #personal,
        #personal .info-grid,
        #personal .card-content {
            filter: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            opacity: 1 !important;
        }
        
        /* Override global loading class that causes opacity issues */
        .profile-header.loading,
        .profile-stats.loading,
        .main-content.loading,
        .container.loading,
        .header.loading,
        .profile-card.loading,
        #personal.loading,
        body.loading,
        html.loading {
            opacity: 1 !important;
            pointer-events: auto !important;
            filter: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }
        
        /* Prevent locked state from affecting Personal section */
        #personal .locked,
        #personal .locked-card {
            pointer-events: auto !important;
            opacity: 1 !important;
        }
        
        /* Remove any potential overlay or pseudo-element blur */
        *::before,
        *::after {
            filter: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
        }
        
        /* Force remove any dimmed or loading states */
        .dimmed,
        .loading {
            opacity: 1 !important;
            filter: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            pointer-events: auto !important;
        }
    </style>
    
    <script>
        // Card editing functions
        function editCard(cardId) {
            const card = document.getElementById(cardId);
            if (!card) return;
            
            const editableFields = card.querySelectorAll('.editable-field');
            const editBtn = card.parentElement.querySelector('.edit-btn');
            const cardActions = card.querySelector('.card-actions');
            
            // Convert spans to inputs
            editableFields.forEach(field => {
                const currentValue = field.textContent;
                const fieldName = field.dataset.field;
                
                if (field.tagName === 'A') {
                    // Handle phone links
                    const input = document.createElement('input');
                    input.type = 'tel';
                    input.value = currentValue;
                    input.className = 'editable-field phone-input';
                    input.dataset.field = fieldName;
                    field.parentNode.replaceChild(input, field);
                } else {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = currentValue;
                    input.className = 'editable-field';
                    input.dataset.field = fieldName;
                    field.parentNode.replaceChild(input, field);
                }
            });
            
            // Hide edit button and show save/cancel buttons
            editBtn.style.display = 'none';
            cardActions.style.display = 'flex';
        }
        
        function saveCard(cardId) {
            const card = document.getElementById(cardId);
            if (!card) return;
            
            const editableFields = card.querySelectorAll('.editable-field');
            const editBtn = card.parentElement.querySelector('.edit-btn');
            const cardActions = card.querySelector('.card-actions');
            
            // Convert inputs back to spans
            editableFields.forEach(field => {
                const currentValue = field.value;
                const fieldName = field.dataset.field;
                
                if (field.classList.contains('phone-input')) {
                    // Handle phone links
                    const link = document.createElement('a');
                    link.href = `tel:${currentValue}`;
                    link.textContent = currentValue;
                    link.className = 'phone-link editable-field';
                    link.dataset.field = fieldName;
                    field.parentNode.replaceChild(link, field);
                } else {
                    const span = document.createElement('span');
                    span.textContent = currentValue;
                    span.className = 'editable-field';
                    span.dataset.field = fieldName;
                    field.parentNode.replaceChild(span, field);
                }
            });
            
            // Show edit button and hide save/cancel buttons
            editBtn.style.display = 'flex';
            cardActions.style.display = 'none';
            
            // Show success toast
            showToast('Personal information updated successfully', 'success');
        }
        
        function cancelEdit(cardId) {
            const card = document.getElementById(cardId);
            if (!card) return;
            
            const editableFields = card.querySelectorAll('.editable-field');
            const editBtn = card.parentElement.querySelector('.edit-btn');
            const cardActions = card.querySelector('.card-actions');
            
            // Restore original values (you might want to store these when editing starts)
            editableFields.forEach(field => {
                const fieldName = field.dataset.field;
                let originalValue = '';
                
                // Get original values based on field name
                switch(fieldName) {
                    case 'fullName': originalValue = 'John Doe'; break;
                    case 'dateOfBirth': originalValue = '12 Mar 1985'; break;
                    case 'nationalId': originalValue = '3174************'; break;
                    case 'passportNo': originalValue = 'C123456'; break;
                    case 'homeAddress': originalValue = 'Jl. Mawar No 8, Surabaya'; break;
                    case 'mobileNo': originalValue = '+62 812 34 5678 90'; break;
                    case 'personalEmail': originalValue = 'john.personal@gmail.com'; break;
                    default: originalValue = field.value || field.textContent;
                }
                
                if (field.classList.contains('phone-input')) {
                    // Handle phone links
                    const link = document.createElement('a');
                    link.href = `tel:${originalValue}`;
                    link.textContent = originalValue;
                    link.className = 'phone-link editable-field';
                    link.dataset.field = fieldName;
                    field.parentNode.replaceChild(link, field);
                } else {
                    const span = document.createElement('span');
                    span.textContent = originalValue;
                    span.className = 'editable-field';
                    span.dataset.field = fieldName;
                    field.parentNode.replaceChild(span, field);
                }
            });
            
            // Show edit button and hide save/cancel buttons
            editBtn.style.display = 'flex';
            cardActions.style.display = 'none';
        }
        
        // Document upload functions
        function uploadDocument(docType) {
            // Simulate file upload
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.jpg,.jpeg,.png,.pdf';
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Update UI to show uploaded status
                    const docItem = document.querySelector(`[data-doc-type="${docType}"]`);
                    if (docItem) {
                        const badge = docItem.querySelector('.badge');
                        const uploadBtn = docItem.querySelector('.upload-btn');
                        
                        badge.className = 'badge uploaded';
                        badge.innerHTML = '<i class="fas fa-check"></i> Uploaded';
                        uploadBtn.textContent = 'Replace';
                    }
                    
                    showToast(`${docType} uploaded successfully`, 'success');
                }
            };
            fileInput.click();
        }
        
        // Business information functions
        function requestChange() {
            showToast('Change request sent to HR team', 'info');
        }
        
        function showRestrictedModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>Restricted Information</h3>
                    <p>This information is restricted and can only be accessed by authorized Finance team members.</p>
                    <p>If you need to view or update this information, please contact:</p>
                    <p><strong>Finance Team</strong><br>
                    Email: finance@company.com<br>
                    Phone: +62 21 1234 5678</p>
                    <div class="modal-buttons">
                        <button class="modal-btn cancel" onclick="closeModal()">Close</button>
                        <button class="modal-btn primary" onclick="contactFinance()">Contact Finance</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function contactFinance() {
            window.location.href = 'mailto:finance@company.com?subject=Request for Bank/Tax Information Access';
            closeModal();
        }
        
        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }
        
        // Toast notification function
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // Add toast styles if not already present
            if (!document.querySelector('#toast-styles')) {
                const style = document.createElement('style');
                style.id = 'toast-styles';
                style.textContent = `
                    .toast {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        padding: 12px 20px;
                        border-radius: 8px;
                        color: white;
                        font-weight: 500;
                        z-index: 1000;
                        animation: slideIn 0.3s ease;
                    }
                    .toast-success { background: #10b981; }
                    .toast-error { background: #ef4444; }
                    .toast-info { background: #3b82f6; }
                    .toast-content {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(toast);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Guard against unsaved changes
        let hasUnsavedChanges = false;
        
        // Track form changes
        document.addEventListener('input', function(e) {
            if (e.target.matches('input, textarea, select')) {
                hasUnsavedChanges = true;
            }
        });
        
        // Warn before leaving page with unsaved changes
        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
        
        // Reset unsaved changes flag when form is saved
        function markAsSaved() {
            hasUnsavedChanges = false;
        }
        
        // Add to existing save functions
        const originalSaveSensitiveFieldValue = saveSensitiveFieldValue;
        saveSensitiveFieldValue = function(fieldId, fieldName) {
            originalSaveSensitiveFieldValue(fieldId, fieldName);
            markAsSaved();
        };
        
        // Skeleton loading functions removed to prevent blur issues
        
        // Removed loadSectionData to prevent blur issues
        
        // Toggle More dropdown
        function toggleMoreMenu() {
            const btn = document.querySelector('.more-btn');
            const dropdown = document.querySelector('.more-dropdown');
            if (!btn || !dropdown) return;
            
            const isExpanded = btn.getAttribute('aria-expanded') === 'true';
            
            btn.setAttribute('aria-expanded', !isExpanded);
            dropdown.classList.toggle('show');
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const moreBtn = document.querySelector('.more-btn');
            const dropdown = document.querySelector('.more-dropdown');
            
            if (moreBtn && dropdown && !moreBtn.contains(e.target) && !dropdown.contains(e.target)) {
                moreBtn.setAttribute('aria-expanded', 'false');
                dropdown.classList.remove('show');
            }
        });
        
        // Enhanced scroll spy for navigation with dropdown support
        function initScrollSpy() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        
                        // Remove active from all nav links
                        document.querySelectorAll('.subnav a, .more-dropdown a').forEach(link => {
                            link.classList.remove('active');
                            link.removeAttribute('aria-current');
                        });
                        
                        // Set active link
                        const activeLink = document.querySelector(`.subnav a[href="#${id}"], .more-dropdown a[href="#${id}"]`);
                        if (activeLink) {
                            activeLink.classList.add('active');
                            activeLink.setAttribute('aria-current', 'page');
                        }
                        
                        // Update dropdown selection
                        const select = document.querySelector('.subnav-select');
                        if (select) {
                            select.value = `#${id}`;
                        }
                    }
                });
            }, {
                threshold: 0.5,
                rootMargin: '-90px 0px -50% 0px'
            });
            
            // Observe all sections
            document.querySelectorAll('.profile-card[id]').forEach(section => {
                observer.observe(section);
            });
        }
        
        // Initialize page - consolidated and optimized
        document.addEventListener('DOMContentLoaded', function() {
            // Aggressive removal of loading/dimmed classes
            function removeLoadingStates() {
                document.querySelectorAll('.loading, .dimmed, [class*="loading"], [class*="dimmed"]').forEach(el => {
                    el.classList.remove('loading', 'dimmed');
                    el.removeAttribute('data-loading');
                    el.removeAttribute('data-dimmed');
                });
                
                // Force clear inline styles that might cause blur
                const allElements = document.querySelectorAll('*');
                allElements.forEach(el => {
                    if (el.style.filter && el.style.filter.includes('blur')) {
                        el.style.filter = 'none';
                    }
                    if (el.style.backdropFilter) {
                        el.style.backdropFilter = 'none';
                    }
                    if (el.style.webkitBackdropFilter) {
                        el.style.webkitBackdropFilter = 'none';
                    }
                });
            }
            
            // Run immediately
            removeLoadingStates();
            
            // Run again after a short delay to catch any dynamically added classes
            setTimeout(removeLoadingStates, 100);
            setTimeout(removeLoadingStates, 500);
            
            // Ensure no blur on main elements
            const mainElements = document.querySelectorAll('body, html, .main-content, .container, .header, .profile-card, #personal, .profile-header, .profile-stats');
            mainElements.forEach(el => {
                el.style.filter = 'none';
                el.style.backdropFilter = 'none';
                el.style.webkitBackdropFilter = 'none';
                el.style.opacity = '1';
                el.style.pointerEvents = 'auto';
            });
            
            // Initialize scroll spy
            initScrollSpy();
            
            // Show toast notification for successful load
            setTimeout(() => {
                showToast('Profile data loaded successfully', 'success');
            }, 800);
            
            // Periodic check to prevent loading states from returning
            setInterval(removeLoadingStates, 2000);
        });
    </script>
</body>
</html>
